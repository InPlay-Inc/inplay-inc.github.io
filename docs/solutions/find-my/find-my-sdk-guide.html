<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="InPlay Find My SDK Guide # Overview # The IN610 Find My SDK is compliant with the most recent versions of both Apple’s Find My Network Accessory Specification and Google’s Find My Device Network Accessory Specification. This guide provides detailed instructions for configuring, compiling, and installing the IN610 Find My SDK to implement an IN610-based Find My Network Accessory. A typical hardware block diagram for a Find My accessory is as below:"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="InPlay Find My SDK Guide # Overview # The IN610 Find My SDK is compliant with the most recent versions of both Apple’s Find My Network Accessory Specification and Google’s Find My Device Network Accessory Specification. This guide provides detailed instructions for configuring, compiling, and installing the IN610 Find My SDK to implement an IN610-based Find My Network Accessory. A typical hardware block diagram for a Find My accessory is as below:"><meta property="og:type" content="article"><meta property="og:url" content="/docs/solutions/find-my/find-my-sdk-guide.html"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2025-01-22T10:43:21+08:00"><title>Find My Sdk Guide | InPlay Doc</title>
<link rel=manifest href=../../../manifest.json><link rel=icon href=../../../favicon.png><link rel=stylesheet href=../../../book.min.7b5ca60448c7e874974d6d12156f89c2b32da59c25ae776b2522852d3ebb0865.css><script defer src=../../../flexsearch.min.js></script><script defer src=../../../en.search.min.6e55bd7517d373a6194d9251b4d35f1d411dcd775f0120d1d67e99930c2f0742.js></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=../../../><span>InPlay Doc</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-ee8b8fb3a2ebd2cf7f56e1b840730602 class=toggle>
<label for=section-ee8b8fb3a2ebd2cf7f56e1b840730602 class="flex justify-between"><a role=button>IN100</a></label><ul></ul></li><li><span>IN6XXE</span><ul><li><input type=checkbox id=section-10a602a2afbac6b637ea6cafedc74c08 class=toggle>
<label for=section-10a602a2afbac6b637ea6cafedc74c08 class="flex justify-between"><a role=button>Getting Started</a></label><ul><li><input type=checkbox id=section-c0533e207424bbd85c1ed5e367c68a38 class=toggle>
<label for=section-c0533e207424bbd85c1ed5e367c68a38 class="flex justify-between"><a role=button>Installation</a></label><ul><li><a href=../../../docs/in6xxe/getting-started/installation/quick-start.html>Quick Start</a></li><li><a href=../../../docs/in6xxe/getting-started/installation/quick-start-with-gcc.html>Quick Start with GCC</a></li><li><a href=../../../docs/in6xxe/getting-started/installation/run-zephyr-on-in6xxe.html>Run Zephyr on IN6XXE</a></li></ul></li><li><input type=checkbox id=section-4ee5b2397a599e035459a043e9269243 class=toggle>
<label for=section-4ee5b2397a599e035459a043e9269243 class="flex justify-between"><a role=button>Configration and Building</a></label><ul></ul></li><li><input type=checkbox id=section-0fcab4eb5e7d4aac163677313b48ef9d class=toggle>
<label for=section-0fcab4eb5e7d4aac163677313b48ef9d class="flex justify-between"><a role=button>Download Image</a></label><ul><li><a href=../../../docs/in6xxe/getting-started/download/jflash-download-guide.html>JFlash Programming</a></li></ul></li><li><input type=checkbox id=section-620480f69a74c9672be0a1ecdaca3f9a class=toggle>
<label for=section-620480f69a74c9672be0a1ecdaca3f9a class="flex justify-between"><a role=button>Testing and Debuging</a></label><ul><li><a href=../../../docs/in6xxe/getting-started/testing/rtt-viewer-guide.html>Rtt Viewer Guide</a></li><li><a href=../../../docs/in6xxe/getting-started/testing/debug-guide.html>Debug Guide</a></li><li><a href=../../../docs/in6xxe/getting-started/testing/hci_command.html>HCI Command</a></li></ul></li></ul></li><li><input type=checkbox id=section-e9d08457f4c51bb4cb1e62cc94f322dc class=toggle>
<label for=section-e9d08457f4c51bb4cb1e62cc94f322dc class="flex justify-between"><a role=button>User Guides</a></label><ul><li><input type=checkbox id=section-e7402e460cdffdf6d75edb23894ae0c5 class=toggle>
<label for=section-e7402e460cdffdf6d75edb23894ae0c5 class="flex justify-between"><a role=button>Driver Integration</a></label><ul><li><a href=../../../docs/in6xxe/user-guides/driver-integration/adc-guide.html>ADC Guide</a></li><li><a href=../../../docs/in6xxe/user-guides/driver-integration/antenna-diversity.html>Antenna Diversity</a></li><li><a href=../../../docs/in6xxe/user-guides/driver-integration/aoa-antenna.html>AOA Antenna Guide</a></li><li><a href=../../../docs/in6xxe/user-guides/driver-integration/counter-development-guide.html>Counter Guide</a></li><li><a href=../../../docs/in6xxe/user-guides/driver-integration/crc-guide.html>CRC Guide</a></li><li><a href=../../../docs/in6xxe/user-guides/driver-integration/gpio-guide.html>GPIO Guide</a></li><li><a href=../../../docs/in6xxe/user-guides/driver-integration/i2c-guide.html>I2C Communication</a></li><li><a href=../../../docs/in6xxe/user-guides/driver-integration/spi-guide.html>SPI Communication</a></li><li><a href=../../../docs/in6xxe/user-guides/driver-integration/uart-guide.html>UART Communication</a></li></ul></li><li><input type=checkbox id=section-54628a101b07426659df9579479aa6d8 class=toggle>
<label for=section-54628a101b07426659df9579479aa6d8 class="flex justify-between"><a role=button>NanoSync Technology</a></label><ul><li><a href=../../../docs/in6xxe/user-guides/nanosync-technology/advanced-timer-guide.html>NanoSync Timer Guide</a></li><li><a href=../../../docs/in6xxe/user-guides/nanosync-technology/trigger-handler-guide.html>NanoSync Engine Guide</a></li></ul></li></ul></li><li><input type=checkbox id=section-782653f6bb259ea0ac24d90b105a7dc0 class=toggle>
<label for=section-782653f6bb259ea0ac24d90b105a7dc0 class="flex justify-between"><a role=button>Protocol Reference</a></label><ul><li><input type=checkbox id=section-5f58fc20691c6de2641f46a033a55d28 class=toggle>
<label for=section-5f58fc20691c6de2641f46a033a55d28 class="flex justify-between"><a role=button>BLE</a></label><ul><li><a href=../../../docs/in6xxe/protocols-reference/ble/inplay-ble5.0-at-command-set.html>BLE5.0 AT Command Set</a></li></ul></li><li><input type=checkbox id=section-614316ec926d5d4f33757567a52185b7 class=toggle>
<label for=section-614316ec926d5d4f33757567a52185b7 class="flex justify-between"><a role=button>SDR</a></label><ul></ul></li><li><input type=checkbox id=section-7570f1740ec51694c058a21927f48553 class=toggle>
<label for=section-7570f1740ec51694c058a21927f48553 class="flex justify-between"><a role=button>SMULL</a></label><ul><li><a href=../../../docs/in6xxe/protocols-reference/smull/inplay-smull-development-guide.html>SMULL Command Set</a></li></ul></li></ul></li><li><input type=checkbox id=section-67e1be7c03648874e72d6c95838f0f26 class=toggle>
<label for=section-67e1be7c03648874e72d6c95838f0f26 class="flex justify-between"><a href=../../../docs/in6xxe/api-documatation.html>API Documentation</a></label><ul></ul></li><li><input type=checkbox id=section-42952569164db7f3f6f894adee6e4523 class=toggle>
<label for=section-42952569164db7f3f6f894adee6e4523 class="flex justify-between"><a role=button>Tools</a></label><ul><li><a href=../../../docs/in6xxe/tools/ota-app-develop-guide.html>InPlay OTA App Development Guide</a></li><li><a href=../../../docs/in6xxe/tools/ota-app.html>InPlayOTA App Guide</a></li></ul></li><li><input type=checkbox id=section-df7b9e936bf162d5e2a48a7f82ae2852 class=toggle>
<label for=section-df7b9e936bf162d5e2a48a7f82ae2852 class="flex justify-between"><a role=button>Examples and Use Case</a></label><ul><li><a href=../../../docs/in6xxe/examples-and-use-case/debug-reference.html>Debug Reference</a></li><li><input type=checkbox id=section-26e2ce46acb4d4970a7850c67da09d8c class=toggle>
<label for=section-26e2ce46acb4d4970a7850c67da09d8c class="flex justify-between"><a role=button>Driver Examples</a></label><ul><li><a href=../../../docs/in6xxe/examples-and-use-case/driver-examples/adc-sample.html>ADC Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/driver-examples/aes-sample.html>AES Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/driver-examples/ecc-sample.html>ECC Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/driver-examples/gpio-interrupt-sample.html>GPIO Interrupt Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/driver-examples/gpio-reset-sample.html>GPIO Reset Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/driver-examples/gpio-sample.html>GPIO Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/driver-examples/gpio-wake-interrupt-sample.html>GPIO Wake Interrupt Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/driver-examples/gpio-wake-sample.html>GPIO Wake Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/driver-examples/i2c-sample.html>I2C Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/driver-examples/keyboard-sample.html>Keyboard Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/driver-examples/pwm-sample.html>PWM Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/driver-examples/qdec-sample.html>QDEC Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/driver-examples/spi-sample.html>SPI Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/driver-examples/timer-sample.html>Timer Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/driver-examples/trigger-example-guide.html>Trigger Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/driver-examples/uart-sample-guide.html>UART Sample</a></li></ul></li><li><input type=checkbox id=section-542a43954a490ea3485a8e09b1381781 class=toggle>
<label for=section-542a43954a490ea3485a8e09b1381781 class="flex justify-between"><a role=button>Misc Examples</a></label><ul><li><a href=../../../docs/in6xxe/examples-and-use-case/misc/hci-sample.html>HCI Sample</a></li></ul></li><li><input type=checkbox id=section-48884cb02637a51d8702e5e3edfef40c class=toggle>
<label for=section-48884cb02637a51d8702e5e3edfef40c class="flex justify-between"><a role=button>BLE Examples</a></label><ul><li><a href=../../../docs/in6xxe/examples-and-use-case/ble/ble-advertising-sample.html>BLE advertising Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/ble/ble-gatt-sample.html>BLE GATT Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/ble/ble-initiation-sample.html>BLE Initiation Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/ble/ble-keyboard-sample.html>BLE Keyboard Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/ble/ble-scan-sample.html>BLE Scan Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/ble/ble-transparent-transmission-sample.html>BLE Transparent Transmission Sample</a></li></ul></li><li><input type=checkbox id=section-f989d19f5bf8a5459f7ee77a2dbc2a37 class=toggle>
<label for=section-f989d19f5bf8a5459f7ee77a2dbc2a37 class="flex justify-between"><a role=button>SDR Examples</a></label><ul><li><a href=../../../docs/in6xxe/examples-and-use-case/sdr/sdr-1-master-to-multiple-slave-sample.html>SDR 1 to n Sample</a></li><li><a href=../../../docs/in6xxe/examples-and-use-case/sdr/sdr-broadcast-sample-.html>SDR Broadcast Sample</a></li></ul></li></ul></li><li><input type=checkbox id=section-ecb777ba06679db84f6d08dc316cb5b2 class=toggle>
<label for=section-ecb777ba06679db84f6d08dc316cb5b2 class="flex justify-between"><a role=button>Development Kits</a></label><ul><li><a href=../../../docs/in6xxe/dk/introduction-to-in6xxe-dk.html>Introduction to IN6XXE DK</a></li></ul></li></ul></li><li><input type=checkbox id=section-0bc0ac0bfec6b1ae25463138a2ae299e class=toggle checked>
<label for=section-0bc0ac0bfec6b1ae25463138a2ae299e class="flex justify-between"><a role=button>Solutions</a></label><ul><li><input type=checkbox id=section-f3c900f3ced930b282424e06187e7b20 class=toggle checked>
<label for=section-f3c900f3ced930b282424e06187e7b20 class="flex justify-between"><a role=button>Find My</a></label><ul><li><a href=../../../docs/solutions/find-my/find-my-sdk-guide.html class=active>Find My Sdk Guide</a></li></ul></li><li><input type=checkbox id=section-01b7a4cd745504c7ef54cce6910e09a8 class=toggle>
<label for=section-01b7a4cd745504c7ef54cce6910e09a8 class="flex justify-between"><a role=button>MultiConnNet</a></label><ul><li><a href=../../../docs/solutions/multiconnnet/introduction.html>Introduction</a></li><li><a href=../../../docs/solutions/multiconnnet/command-set.html>Module Instruction Set</a></li><li><a href=../../../docs/solutions/multiconnnet/user-guild.html>User Guild</a></li></ul></li><li><input type=checkbox id=section-afc3c4284a3a81612ced6ce66dbe01d3 class=toggle>
<label for=section-afc3c4284a3a81612ced6ce66dbe01d3 class="flex justify-between"><a role=button>SMULL Pass-through Network</a></label><ul><li><a href=../../../docs/solutions/smull/inplay-smull-development-guide.html>SMULL Command Set</a></li></ul></li><li><input type=checkbox id=section-3c853b7573728b720bb9f6d05f87354b class=toggle>
<label for=section-3c853b7573728b720bb9f6d05f87354b class="flex justify-between"><a role=button>Stellar</a></label><ul><li><a href=../../../docs/solutions/stellar/stellar-gateway-wireless-communication-protocol-implementation-guide.html>Wireless Communication Protocol</a></li></ul></li><li><input type=checkbox id=section-15c87bcd4d931f9a897cb9565047755d class=toggle>
<label for=section-15c87bcd4d931f9a897cb9565047755d class="flex justify-between"><a role=button>Wireless Modbus Network</a></label><ul><li><a href=../../../docs/solutions/modbus/wireless-modbus-demo-guide.html>Wireless Modbus Demo Guide</a></li><li><a href=../../../docs/solutions/modbus/wireless-modbus-module.html>Wireless Modbus Module</a></li></ul></li></ul></li><li><input type=checkbox id=section-7e7f18f2dd14f1d43dd9be3434b07e7b class=toggle>
<label for=section-7e7f18f2dd14f1d43dd9be3434b07e7b class="flex justify-between"><a role=button>IN6XX</a></label><ul><li><input type=checkbox id=section-63252a7c2c256e222256d33b9f7363a6 class=toggle>
<label for=section-63252a7c2c256e222256d33b9f7363a6 class="flex justify-between"><a role=button>Getting Started</a></label><ul><li><input type=checkbox id=section-7e1496f76a7a40a604ce733f3e2bdacf class=toggle>
<label for=section-7e1496f76a7a40a604ce733f3e2bdacf class="flex justify-between"><a role=button>Installation</a></label><ul><li><a href=../../../docs/in6xx/getting-started/installation/quick-start.html>Quick Start</a></li></ul></li><li><input type=checkbox id=section-7c5cc973fcb5ebb7f1a051dd9211755c class=toggle>
<label for=section-7c5cc973fcb5ebb7f1a051dd9211755c class="flex justify-between"><a role=button>Configration and Building</a></label><ul></ul></li><li><input type=checkbox id=section-fb6709c7bc2f74dd748ca851379bed41 class=toggle>
<label for=section-fb6709c7bc2f74dd748ca851379bed41 class="flex justify-between"><a role=button>Download Image</a></label><ul><li><a href=../../../docs/in6xx/getting-started/download/in_prog-guide.html>InPlay Programmer Guide</a></li><li><a href=../../../docs/in6xx/getting-started/download/jflash-download-guide.html>JFlash Programming</a></li><li><a href=../../../docs/in6xx/getting-started/download/mp-tool-guide.html>MP Tool Guide</a></li></ul></li><li><input type=checkbox id=section-ed9f99fe4754a35a21fe02be8b0cb4f7 class=toggle>
<label for=section-ed9f99fe4754a35a21fe02be8b0cb4f7 class="flex justify-between"><a role=button>Testing and Debuging</a></label><ul><li><a href=../../../docs/in6xx/getting-started/testing/rtt-viewer-guide.html>Rtt Viewer Guide</a></li><li><a href=../../../docs/in6xx/getting-started/testing/debug-guide.html>Debug Guide</a></li><li><a href=../../../docs/in6xx/getting-started/testing/hci_command.html>HCI Command</a></li></ul></li></ul></li><li><input type=checkbox id=section-4180a1cd8bda36e24d2a9c527ab046fe class=toggle>
<label for=section-4180a1cd8bda36e24d2a9c527ab046fe class="flex justify-between"><a role=button>Protocol Reference</a></label><ul><li><input type=checkbox id=section-7dd9db7eea8acbc738b8e6a6e64afef0 class=toggle>
<label for=section-7dd9db7eea8acbc738b8e6a6e64afef0 class="flex justify-between"><a role=button>BLE</a></label><ul><li><a href=../../../docs/in6xx/protocol-reference/ble/gatt-programming-guide.html>GATT Programming Guide</a></li><li><a href=../../../docs/in6xx/protocol-reference/ble/transparent-data-transmission-component-programming-guide.html>Transparent Data Transmission Component Programming Guide</a></li></ul></li></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=../../../svg/menu.svg class=book-icon alt=Menu>
</label><strong>Find My Sdk Guide</strong>
<label for=toc-control><img src=../../../svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ol><li><a href=#overview>Overview</a></li><li><a href=#required-tools>Required tools</a><ol><li><a href=#compiler-and-build-tools>Compiler and build tools</a></li><li><a href=#image-and-token-programming-tools>Image and token programming tools</a></li></ol></li><li><a href=#source-code-and-software-architecture>Source code and software architecture</a></li><li><a href=#software-configuration>Software configuration</a><ol><li><a href=#bsp-configuration>BSP configuration</a></li><li><a href=#sdk-configuration>SDK configuration</a></li><li><a href=#supported-protocol>Supported protocol</a></li><li><a href=#google-fmdn-and-apple-fmna-configuration>Google FMDN and Apple FMNA configuration</a></li></ol></li><li><a href=#flash-layout>Flash layout</a></li><li><a href=#ui-customization>UI customization</a><ol><li><a href=#find-my-network-disableenable>Find My Network disable/enable</a></li><li><a href=#factory-reset>Factory Reset</a></li><li><a href=#read-serial-number>Read Serial Number</a></li></ol></li><li><a href=#multiple-ble-applications-coexist>Multiple BLE applications coexist</a></li><li><a href=#build-the-project-and-load-the-program-to-the-flash>Build the project and load the program to the flash</a><ol><li><a href=#build-the-project-with-keil>Build the project with Keil</a></li><li><a href=#build-the-project-with-gcc>Build the project with GCC</a></li><li><a href=#run-the-program>Run the program</a></li></ol></li><li><a href=#load-software-authentication-token--uuid>Load Software Authentication Token / UUID</a><ol><li><a href=#token-item-format>Token item format</a></li><li><a href=#run-the-script>Run the script</a></li></ol></li><li><a href=#generate-uarp-file>Generate UARP file</a><ol><li><a href=#generate-the-input-bin-to-mfigr2-tool>Generate the input bin to &ldquo;mfigr2&rdquo; tool</a></li><li><a href=#use-mfigr2-to-generate-uarp-file>Use &ldquo;mfigr2&rdquo; to generate .uarp file</a></li></ol></li><li><a href=#upgrade-the-find-my-accessory>Upgrade the Find My Accessory</a><ol><li><a href=#install-the-fmca-application>Install the FMCA Application</a></li><li><a href=#install-find-my-network-configuration-profile>Install Find My Network Configuration Profile</a></li><li><a href=#update-the-firmware>Update the firmware</a></li></ol></li></ol></nav></aside></header><article class=markdown><h1 id=inplay-find-my-sdk-guide>InPlay Find My SDK Guide
<a class=anchor href=#inplay-find-my-sdk-guide>#</a></h1><h2 id=overview>Overview
<a class=anchor href=#overview>#</a></h2><p>The IN610 Find My SDK is compliant with the most recent versions of both Apple’s Find My Network Accessory Specification and Google’s Find My Device Network Accessory Specification. This guide provides detailed instructions for configuring, compiling, and installing the IN610 Find My SDK to implement an IN610-based Find My Network Accessory. A typical hardware block diagram for a Find My accessory is as below:</p><p><img src=../../../images/solution/FindMy/find_my_hw_block.png alt></p><p>The accessory&rsquo;s key components consist of the IN610 Bluetooth Low Energy (BLE) System-on-Chip (SoC), a key, a buzzer, and a motion sensor. The key acts as an input for one of the GPIOs on the IN610 BLE SoC, facilitating crucial user interactions such as restoring factory settings and turning the device on or off. The buzzer serves to emit sounds to aid in locating items, and when combined with the motion sensor, it can trigger an alarm to prevent unwanted tracking.</p><p>The SDK includes all essential hardware drivers and offers easy customization to meet your specific product needs.</p><h2 id=required-tools>Required tools
<a class=anchor href=#required-tools>#</a></h2><p>Before using the Find My SDK, users must install the necessary tools.</p><h3 id=compiler-and-build-tools>Compiler and build tools
<a class=anchor href=#compiler-and-build-tools>#</a></h3><p>The SDK supports both Keil and GCC. Users can build their applications using either of tools.</p><h4 id=keil>Keil
<a class=anchor href=#keil>#</a></h4><p>If Keil is used to build the project, below tools should be installed:</p><table><thead><tr><th>Tool</th><th>URL or the path in the SDK</th><th>Notes</th></tr></thead><tbody><tr><td>Keil MDK</td><td><a href=https://www.keil.com/download/product/>https://www.keil.com/download/product/</a></td><td>It is recommended to use version 5.29 or higher of the IDE for building the project.</td></tr><tr><td>InPlayInc.DeviceFamilyPack.1.0.6.pack</td><td>in-dev/tools</td><td>Included in the SDK. Integrate IN610 support into Keil.</td></tr></tbody></table><h4 id=gcc>GCC
<a class=anchor href=#gcc>#</a></h4><p>Users can also build the project using GCC on either Windows or Linux. The required tools are ARM GCC and Make.</p><p><strong>ARM GCC</strong></p><p>The recommended ARM GCC toolchain is gcc-arm-none-eabi-9-2020-q2. It can be downloaded from the <a href=https://developer.arm.com/downloads/-/gnu-rm/9-2020-q2-update>Downloads | 9-2020-q2-update – Arm Developer</a> page. When installing the ARM GCC toolchain, ensure that the installation path does not contain special characters such as &ldquo;(&rdquo; or &ldquo;)&rdquo;.</p><p><strong>GNU make utility</strong></p><p>For Windows, download the Make utility from <a href=https://gnuwin32.sourceforge.net/packages/make.htm>Make for Windows</a> and install it on your PC.
If you&rsquo;re using Ubuntu, install Make using the following commands:</p><pre tabindex=0><code>sudo apt-get update
sudo apt-get install build-essential
</code></pre><p>After installing Make on Windows or Ubuntu, ensure you add its path to the PATH environment variable.</p><h3 id=image-and-token-programming-tools>Image and token programming tools
<a class=anchor href=#image-and-token-programming-tools>#</a></h3><p>Once users successfully build the project, they can download the application image to the IN610 using either the J-Link or UART interface. These are required tools:</p><table><thead><tr><th>Tool</th><th>URL or path in the SDK</th><th>Notes</th></tr></thead><tbody><tr><td>SEGGER J-Link</td><td><a href=https://www.segger.com/downloads/jlink/>https://www.segger.com/downloads/jlink/</a></td><td>Version 7.62 or higher is recommended.</td></tr><tr><td>InPlayToolsSetup.exe</td><td>in-dev/tools</td><td>Included in the SDK. Add IN610 support for J-Flash</td></tr></tbody></table><p>The Windows application &ldquo;inplay_programmer&rdquo; included in the SDK (in-dev/tools/in_prog) can be used to download the application image by using UART.</p><p>The &ldquo;in610_fmna_program&rdquo; shown in below table is used to load the Apple token to IN610 either using J-Link or UART.</p><table><thead><tr><th>Tool</th><th>URL or path in the SDK</th><th>Notes</th></tr></thead><tbody><tr><td>Python 3.x</td><td><a href=https://www.python.org/downloads/>https://www.python.org/downloads/</a></td><td>The In610_fmna_program utilizes a Python script to upload the Apple Find My token to the internal flash memory of the IN610.</td></tr><tr><td>in610_fmna_program</td><td>in-dev/proj/proj_ble_find_my/tools</td><td>Included in the SDK. A toolset designed for loading the Apple Find My token to the internal flash memory of the IN610.</td></tr></tbody></table><h2 id=source-code-and-software-architecture>Source code and software architecture
<a class=anchor href=#source-code-and-software-architecture>#</a></h2><p>The source code for the Find My project is located in the in-dev/proj/proj_ble_find_my directory:</p><ul><li>build<ul><li>gcc: GCC build directory</li><li>mdk: Keil MDK project file: proj_ble_lp.uvprojx</li></ul></li><li>inc: in_config.h is platform configuration file, fm_config.h is the Find My SDK configuration file.<ul><li>boards: Specific board configuration files</li><li>lib: Apple and Google Find My libraries</li></ul></li><li>src<ul><li>app: Application layer, key operation definitions, storage, power on/off etc.</li><li>bsp: Board Support Package, some necessary device drivers</li><li>fmna: Apple Find My Network Accessory Specification related code</li><li>nearby: Google Find My Device Network Accessory Specification related code</li><li>utils</li></ul></li><li>tools<ul><li>in610_fmna_program: Tool to load Apple’s token to IN610 chip</li><li>UARP: Apple’s UARP tools</li></ul></li></ul><p>The architecture of the IN610 Find My software is illustrated as below:</p><p><img src=../../../images/solution/FindMy/sw_arch.png alt></p><h2 id=software-configuration>Software configuration
<a class=anchor href=#software-configuration>#</a></h2><p>The configuration options for the IN610 Find My SDK are specified in the file &ldquo;in-dev/proj/proj_ble_find_my/inc/fm_config.h&rdquo;. This file includes a file named &ldquo;fm_models.h&rdquo;, which includes some hardware related macros.
At the beginning of the file &ldquo;fm_models.h&rdquo;, a macro prefixed with &ldquo;USE_&rdquo; is defined to specify the target board. By default, the macro USE_DK is defined for InPlay&rsquo;s IN610DK board:</p><pre tabindex=0><code>#define USE_DK  //DK board, B0-07102021
</code></pre><p>If you want to adapt the SDK to a custom hardware platform, you need to define a new macro, such as USE_CUSTOMER_BOARD, and provide a corresponding platform configuration file, such as &ldquo;in_config_customer.h&rdquo;, in the boards directory.</p><h3 id=bsp-configuration>BSP configuration
<a class=anchor href=#bsp-configuration>#</a></h3><p>The SDK&rsquo;s Board Support Package (BSP) includes device drivers for key inputs, buzzer, and motion sensor functionalities. These drivers&rsquo; source code can be found in the &ldquo;bsp&rdquo; directory.</p><h4 id=key-driver>Key driver
<a class=anchor href=#key-driver>#</a></h4><p>The bsp_gpio_key.c file acts as the key driver, enabling features like single press, double press, and long press etc. To enable the GPIO key driver, set the macro USE_GPIO_KEY to 1 in the fm_config.h file. The key can be connected to any available GPIO pin, and the desired GPIO can be specified using the macro defined in fm_models.h:</p><pre tabindex=0><code>#define GPIO_KEY_PORT 0  // The GPIO port to which the key is connected.
#define GPIO_KEY_PIN 0    // The pin of the GPIO port that connects to the key.
#define GPIO_KEY_ACTIVE 1  // The active level of the GPIO key input. 
</code></pre><p><strong>Note:</strong> The GPIO key input should always be active at a high level. In DK board, S3 is used as the GPIO Key, which is connected to GPIO_0_0.</p><h4 id=buzzer-driver>Buzzer driver
<a class=anchor href=#buzzer-driver>#</a></h4><p>The bsp_buzzer.c file serves as the buzzer driver, utilizing PWM waveforms to drive a buzzer.</p><p>Buzzers are classified into two types: magnetic buzzers and piezo buzzers. Magnetic buzzers produce sound by passing current through a coil, generating a magnetic field that moves a diaphragm to create sound waves. Piezo buzzers operate using the piezoelectric effect, where an alternating current causes a piezoelectric material to expand and contract, producing sound vibrations.</p><p>To generate a sound both magnetic buzzers and piezo buzzers require a PWM signal. The frequency of this PWM signal corresponds to the pitch of the note you want to play. Magnetic buzzers draw more current than piezo buzzers due to their fundamental design and operating principles. It is recommended to use piezo buzzers.</p><p>The IN610 features three GPIOs that support PWM:</p><table><thead><tr><th>GPIO</th><th>Port Number</th><th>Pin Number</th><th>PWM ID</th></tr></thead><tbody><tr><td>GPIO_0_2</td><td>0</td><td>2</td><td>PWM2_ID</td></tr><tr><td>GPIO_1_7</td><td>1</td><td>7</td><td>PWM3_ID</td></tr><tr><td>GPIO_1_8</td><td>1</td><td>8</td><td>PWM4_ID</td></tr></tbody></table><p>Users can select which GPIO to use for PWM by configuring the corresponding macro in fm_model.h:</p><pre tabindex=0><code>#define BUZZER_PWM_ID PWM2_ID  //PWM id corresponding to the GPIO
</code></pre><p>For magnetic buzzers, users can configure the active level of the PWM using the following macro. The active level defines the state in which the PWM signal enables a higher current to flow through the coil:</p><pre tabindex=0><code>#define BUZZER_ACTIVE_LEVEL 1
</code></pre><p>The buzzer driver allows users to customize sounds by defining buzzer sequences for various states of the Find My accessory device. Each entry in the sequence can specify how long the buzzer remains active, how long it stays inactive, and the PWM frequency during its active state. In the SDK, the following buzzer sequences are available and defined in &ldquo;app_buzzer.c&rdquo;:</p><table><thead><tr><th>Buzzer sequence variable</th><th>When to be used</th></tr></thead><tbody><tr><td>g_power_on_seq</td><td>The Find My accessory is powered on</td></tr><tr><td>g_power_off_seq</td><td>The Find My accessory is powered off</td></tr><tr><td>g_play_sound_seq</td><td>Played when playing sound through App, or unwanted tracking with motion detected</td></tr><tr><td>g_reset_seq</td><td>Factory reset successfully</td></tr><tr><td>g_unpair_seq</td><td>Unpaired successfully</td></tr><tr><td>g_paired_seq</td><td>Paired successfully</td></tr></tbody></table><p>Examples of buzzer sequence definitions are available in the app_buzzer.c file. One such example is the power-on sequence, which users can configure to play sounds when the device is powered on:</p><pre tabindex=0><code>buzzer_seq_t g_power_on_seq = {
    .evt = g_power_on_evts,
    .repeat_count = 1,
    .seq_len = 3,
};
</code></pre><p>The g_power_on_seq buzzer sequence consists of three entries (defined by seq_len), each specifying its on duration (in 10 ms), off duration, and PWM frequency (in Hz). The repeat count is set to 1, meaning the entire sequence (comprising the three entries) will play once.</p><p>Users can call the bsp_buzzer_start_seq function to play a buzzer sequence, as shown in the following example:</p><pre tabindex=0><code>bsp_buzzer_start_seq(&amp;g_power_on_seq).
</code></pre><h4 id=motion-sensor-driver>Motion sensor driver
<a class=anchor href=#motion-sensor-driver>#</a></h4><p>The &ldquo;bsp_acc.c&rdquo; is the motion sensor driver. Currently, the SDK supports only the LIS2DH12 as the motion sensor. The driver allows users to specify the IN610 I2C interface in use, along with one GPIO pin that can receive interrupts from the motion sensor.</p><p>The bsp_acc.c file serves as the motion sensor driver. Currently, the SDK supports only the LIS2DH12 motion sensor. The driver allows users to configure the IN610 I2C interface and specify the GPIO pin for receiving interrupts from the motion sensor.</p><p>The IN610 offers two options for the I2C interface, as outlined in below table:</p><table><thead><tr><th>I2C ID</th><th>SCL SDA</th></tr></thead><tbody><tr><td>I2C0_ID</td><td>GPIO_0_0</td></tr><tr><td>I2C1_ID</td><td>GPIO_4_0</td></tr></tbody></table><p>Users can select the desired interface by setting the I2C_BUS macro in fm_models.h as follows:</p><pre tabindex=0><code>#define I2C_BUS I2C0_ID  // Select I2C0 for the interface
</code></pre><p>The I2C address of the LIS2DH12 is determined by its SA0 pin state. If the SA0 pin is high (internally pulled-up by default), the address is 0x19. Configure this address using the I2C_ADDR macro:</p><pre tabindex=0><code>#define I2C_ADDR 0x19   // I2C address of the motion sensor chip
</code></pre><p>The LIS2DH12 motion sensor generates interrupts via its INT1 and INT2 pins. The SDK uses the INT2 pin for the interrupt source for the IN610 device. When the sensor is stationary, the INT2 pin outputs a high signal. Upon detecting motion, the pin transitions to low. When returning to a stationary state, it remains low for a brief period before returning to high. Users can specify the GPIO pin on the IN610 device connected to the INT2 pin using the INT2_PORT and INT2_PIN macros in fm_models.h, as shown below:</p><pre tabindex=0><code>#define INT2_PORT 2  //The port of the 2nd GPIO which can receiver interrupt from the motion sensor.
#define INT2_PIN  8 // The pin of the 2nd GPIO which can receiver interrupt from the motion sensor.
</code></pre><h4 id=battery-driver>Battery driver
<a class=anchor href=#battery-driver>#</a></h4><p>The “bsp_battery.c” file functions as the battery driver for monitoring the battery voltage of the Find My accessory device. If the battery directly supplies power to the IN610, the internal ADC channel (ADC_CH14) can be used to measure the supply voltage directly. If the battery does not directly supply power to the IN610, external ADC channels of the IN610 (ADC_CH0 is recommended) must be utilized to measure the battery level. It is important to note that for external ADC channels, the input signal range must remain within [0, 2.0V]. Users are advised to implement a suitable voltage divider to ensure that the input signal range is between [50 mV, 1950 mV] for optimal linearity.</p><p>The driver enables users to define battery levels as &ldquo;Full,&rdquo; &ldquo;Medium,&rdquo; &ldquo;Low,&rdquo; and &ldquo;Critical Low&rdquo; based on the measured battery voltage (in millivolts, mV). These levels can be customized by modifying an array in the bsp_battery.c file, which maps specific voltage ranges to corresponding battery levels.</p><p>For rechargeable batteries, two threshold sets must be configured:</p><ul><li>g_vbat_thr in the bsp_battery.c file for batteries not in a charging state.</li><li>g_vbat_chrg_thr for batteries in a charging state.</li></ul><p>For non-rechargeable batteries, thresholds can be defined using g_vbat_thr.</p><p>The SDK provides example thresholds for reference. For a non-rechargeable battery, the provided examples indicate the following:</p><ul><li>A voltage of 2810 mV or higher corresponds to &ldquo;Full.&rdquo;</li><li>A voltage between 2650 mV and 2810 mV corresponds to &ldquo;Medium.&rdquo;</li><li>A voltage between 2513 mV and 2650 mV corresponds to &ldquo;Low.&rdquo;</li><li>A voltage below 2513 mV corresponds to &ldquo;Critical Low.&rdquo;</li></ul><p>Users can adjust the values to align with the specific characteristics of their battery.</p><p>The following macros can be defined in fm_models.h for configuring the battery driver:</p><pre tabindex=0><code>#define USE_CHARGER // Define this macro if a rechargeable battery is used
#define BATT_TYPE 2  // Indicates a rechargeable battery; this value is used to initialize Find My libraries
#define BAT_VOL_ADC_CH ADC_CH0  // Specifies the ADC channel used to sample battery voltage
#define BAT_VOLTAGE_DIV ((1.2+1.5)/1.2)  // Battery voltage divider configuration
#define BAT_STABLE_DELAY (200000) // Delay (in microseconds) for battery voltage stabilization after reset; set to 0 for ADC_CH0. For mixed-signal pins, additional delay may be needed due to pull-up resistors.
</code></pre><p>If a GPIO pin is connected to the charger for detecting the charging state, it can be defined as follows:</p><pre tabindex=0><code>#define GPIO_CHARG_DET 2,5
</code></pre><p><strong>Note:</strong> If GPIO_CHARG_DET is not defined, the software cannot detect the charging state. Consequently, the g_vbat_chrg_thr parameter will not be used.</p><p>To ensure the tracker powers off automatically when the battery is low, define the following macro in bsp_battery.h to set the power-off voltage for the rechargeable battery:</p><pre tabindex=0><code>#define BAT_POWER_OFF_VOL 3300  // Power off battery voltage in millivolts (mV)
</code></pre><p>If a load switch is used to control the battery voltage sampling, you can define the GPIO pin to manage the load switch as follows:</p><pre tabindex=0><code>#define GPIO_BAT_ADC_EN 1, 8  // Define GPIO to enable load switch
#define ADC_EN_ACTIVE 1  // Define active level of the GPIO
</code></pre><h4 id=boot-pin>Boot Pin
<a class=anchor href=#boot-pin>#</a></h4><p>The boot pin is utilized to signal the boot ROM of the IN610 that a firmware image or data (like Apple token) needs to be downloaded to the flash memory. In the SDK, the default boot pin is GPIO_1_6. If the boot pin is low during the transition of the chip from disabled to enabled (when the CHIP_EN pin goes from low to high), the chip will remain in the boot ROM, awaiting commands from any UART interface to initiate the firmware download. Users can also connect a J-Link to the IN610 in this state.</p><h3 id=sdk-configuration>SDK configuration
<a class=anchor href=#sdk-configuration>#</a></h3><p>Several SDK configuration macros are defined in the fm_config.h file, as detailed in the following sub-sections.</p><h4 id=debug-option>Debug option
<a class=anchor href=#debug-option>#</a></h4><p>The Keil project includes two targets: tracker (release version) and tracker_d (debug version). The differences between these targets are outlined in below table:</p><table><thead><tr><th>Target</th><th>Linked libraries</th><th>FMND_DEBUG defined?</th><th>Description</th></tr></thead><tbody><tr><td>tracker</td><td>fmna_lib.lib, nearby_lib.lib</td><td>No</td><td>Debug messages will <strong>not</strong> be output via UART. The &ldquo;Debug Control Point&rdquo; outlined in the &ldquo;Find My Network Accessory Specification&rdquo; is <strong>not</strong> activated. <strong>Less</strong> flash memory is needed.</td></tr><tr><td>tracker_d</td><td>fmna_lib_d.lib, nearby_lib_d.lib</td><td>Yes</td><td>Debug messages will be output via UART. The &ldquo;Debug Control Point&rdquo; outlined in the &ldquo;Find My Network Accessory Specification&rdquo; is activated. <strong>More</strong> flash memory is needed.</td></tr></tbody></table><p><strong>Note:</strong></p><ol><li>The default debug UART interface is UART1 in the IN610 device, GPIO_2_1 as TXD and GPIO_2_7 as RXD. And the baud rate is 921600.</li><li>If non-debug version libraries (libraries without &ldquo;_d&rdquo; suffix) are used, RAM log are not supported.</li></ol><h3 id=supported-protocol>Supported protocol
<a class=anchor href=#supported-protocol>#</a></h3><p>The SDK supports both the Apple Find My and Google Find My Device protocols. The tracker can be configured to support either one or both.</p><ul><li>If the tracker is configured for one protocol, it can only join the corresponding predefined network.</li><li>If configured for both, the end user can choose whether the tracker joins the Apple or Google network during a factory reset or the first-time power-on.</li></ul><p>To support the Apple Find My protocol, define the following macro in fm_config.h:</p><pre tabindex=0><code>#define USE_APPLE_TRACKER
</code></pre><p>To support the Google Find My Device protocol, define the following macro:</p><pre tabindex=0><code>#define USE_GOOGLE_TRACKER
</code></pre><h4 id=watchdog>Watchdog
<a class=anchor href=#watchdog>#</a></h4><p>Set the following macro to enable the IN610’s AON Watchdog. It is recommended to keep this enabled. To disable the WDT, set the macro to 0:</p><pre tabindex=0><code>#define USE_WDT 1
</code></pre><h4 id=ram-log>RAM log
<a class=anchor href=#ram-log>#</a></h4><p>Set the following macro to &ldquo;1&rdquo; to enable log printing to RAM. You can dump the logs using the InPlayOTA application. This option should be disabled for release versions:</p><pre tabindex=0><code>#define USE_RAM_LOG 1
</code></pre><h4 id=dft-design-for-test-ble-service>DFT (Design for Test) BLE service
<a class=anchor href=#dft-design-for-test-ble-service>#</a></h4><p>DFT service is a BLE service used to write SN, token or dump log. If users don’t need these features, users should set these options to “0”.</p><pre tabindex=0><code>#define USE_DFT_SVC 1 // If set to &#34;1&#34;, a BLE service will be included for testing purposes. For details, refer to app_dft.c.
#define USE_DFT_ADV 0 // If set to &#34;1&#34;, an additional BLE advertisement for testing purposes will be enabled for 1 minute when entering pairing state.
</code></pre><h3 id=google-fmdn-and-apple-fmna-configuration>Google FMDN and Apple FMNA configuration
<a class=anchor href=#google-fmdn-and-apple-fmna-configuration>#</a></h3><p>The configuration options for Google FMDN can be set using the nearby_cfg_t structure when calling nearby_init to initialize the Nearby library. Refer to nearby_user.h for the structure definition.</p><p>Similarly, the configuration options for Apple FMNA can be set using the fmna_cfg_t structure when calling fmna_init to initialize the FMNA library. Refer to fmna_user.h for the structure definition.</p><p>In app_power_state.c, the initialization is implemented as follows:</p><ul><li>Google FMDN is initialized with: nearby_init(&amp;nearby_cfg, reset_reason, &amp;g_app_cfg.fmdn_data);</li><li>Apple Find My Network is initialized with: fmna_init(&amp;fmna_cfg, &amp;nv_data);</li></ul><p>The configuration options are defined as global variables (fmna_cfg and nearby_cfg). Certain members of these structures are initialized using macros.</p><h4 id=model-setup-configuration>Model setup configuration
<a class=anchor href=#model-setup-configuration>#</a></h4><p>For the Google tracker, it is essential to correctly configure the model ID and anti-spoof private key; For the Apple tracker, the product data should be set correctly. They are defined as macros in &ldquo;in-dev/proj/proj_ble_find_my/inc/fm_private.h&rdquo;.</p><p><strong>Note:</strong> By default, these essential macros are set to invalid values. If they are not modified, the tracker will not work.</p><ul><li>MODEL_ID: Model ID distributed by Google</li><li>ANTI_SPOOF_PRIV_KEY: Anti-Spoofing Private Key distributed by Google</li></ul><p>Refer to <a href="https://developers.google.com/nearby/fast-pair/specifications/service/modelregistration?hl=en">Fast Pair|Google for Developers</a> to know how to register a model with Google.</p><p>The Anti-Spoofing Private Key distributed by Google is BASE64 encoded, it should be converted to hexadecimal format, some online tools can be used to do this:</p><p><a href=https://base64.guru/converter/decode/hex>https://base64.guru/converter/decode/hex</a></p><p>For example, if the Base64-encoded private key string is:
&ldquo;AQIDBAUGBwgJCgsMDQ4PEBESExQVFhcYGRobHB0eHyA=&rdquo;</p><p>Convert it to hexadecimal:</p><p>&ldquo;0102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f20&rdquo;</p><p>Then, define the private key in fm_private.h as follows:</p><pre tabindex=0><code>#define ANTI_SPOOF_PRIV_KEY \
    0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, \
    0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10, \
    0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, \
    0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f, 0x20,
</code></pre><p>For the Apple tracker, the product data must be set accurately which is also defined in &ldquo;fm_private.h&rdquo; as FMNA_PRODUCT_DATA.</p><p>Certain common options must be configured for both Apple and Google, including firmware version number, manufacturer name, model name, capability, category, and battery type. Definitions for some macros related to capability, category, and battery type can be found in &ldquo;fm_constants.h&rdquo;.</p><h4 id=rf-related-configuration>RF related configuration
<a class=anchor href=#rf-related-configuration>#</a></h4><p>Certain RF-related configurations must be adjusted to align with the hardware setup. For the IN610 chip, the gain code parameter is used to configure the RF Tx power. Typically, the following values are used:</p><ul><li>gain_code = 0x18: Tx power set to 0 dBm</li><li>gain_code = 0x78: Tx power set to 4 dBm</li></ul><p>However, these values may vary depending on hardware specifics, such as the RF matching network.</p><p>In the IN610 SDK, the Tx power for each advertisement can be configured independently. During a connection, the Tx power used matches that of the corresponding advertisement.</p><p>For Apple Find My, the Tx power must be set to higher than 4 dBm. The relevant settings are members of the fmna_cfg_t structure:</p><ul><li><strong>tx_pwr:</strong> Represents the Tx Power Level characteristic of the Tx Power Service for FMNA and should reflect the Bluetooth LE TRP (Total Radiated Power).</li><li><strong>tx_gain_code:</strong> Configures the Tx power setting of the chip for FMNA advertisements.</li></ul><p>For Google Find My, two types of advertisements are used: Fast Pair and FMDN. Fast Pair advertisements are active during pairing and FMDN advertisements are used after pairing.</p><p>The configurations are members of the nearby_cfg_t structure:</p><ul><li><strong>fp_calibrated_adv_tx_pwr:</strong> The calibrated Fast Pair Tx power at 0m distance, measured in dBm. Refer to <a href="https://developers.google.com/nearby/fast-pair/materials-and-technical-notes?hl=en">Fast Pair Materials and Technical Notes | Google for Developers</a> on the Google Developers site.</li><li><strong>fp_tx_gain_code:</strong> Configures the Tx power setting for Fast Pair advertisements and must be lower than fmdn_tx_gain_code.</li><li><strong>fmdn_tx_gain_code:</strong> Configures the Tx power setting for FMDN advertisements.</li></ul><h4 id=apple-find-my-serial-number-interface>Apple Find My Serial Number interface
<a class=anchor href=#apple-find-my-serial-number-interface>#</a></h4><p>The serial number for Apple Find My is retrieved by the Apple Find My library using the function fmna_plat_get_serial_number in the file fmna_platform.c. By default, the serial number is generated from the chip UUID. However, if USE_NV_SN is set to &ldquo;1&rdquo;, the serial number can be read from flash memory instead.</p><h4 id=function-interface>Function interface
<a class=anchor href=#function-interface>#</a></h4><p>Functions declared in “fmna_platform.h” and “fmna_platform_uarp.h” are called by fmna lib.
Functions defined in “nearby_platform_os.c” are called by nearby lib.
Functions declared in “fmna_user.h” and “nearby_user.h” are APIs called by user application, which are implemented in fmna lib and nearby lib.</p><h2 id=flash-layout>Flash layout
<a class=anchor href=#flash-layout>#</a></h2><p>The flash address 0x0 is mapped to 0x00300000 in the CPU addressing space. Below table provides detailed information about the flash layout.</p><table><thead><tr><th>Address range</th><th>Description</th></tr></thead><tbody><tr><td>0x0 ~ 0x4000</td><td>Boot options and Boot RAM</td></tr><tr><td>0x4000~0x40000</td><td>Application bank A</td></tr><tr><td>0x40000~0x7B000</td><td>Application bank B</td></tr><tr><td>0x7B000~0x7E000</td><td>Pair information and keys</td></tr><tr><td>0x7E000~0x7F000</td><td>Apple software authentication token</td></tr><tr><td>0x7F000~0x80000</td><td>Reserved, can be used to store SN, etc.</td></tr></tbody></table><p><strong>Note:</strong> The SDK supports firmware upgrades using A/B banks. At any given time, the application program is stored in either Application Bank A or Application Bank B. Keil can only program firmware to Bank A. If the firmware is upgraded to Bank B, the sector at address 0x3000 must be erased before running a program loaded with Keil.</p><h2 id=ui-customization>UI customization
<a class=anchor href=#ui-customization>#</a></h2><p>A Find My Accessory typically supports several operations, including enabling or disabling the Find My Network, performing a factory reset, and reading the serial number. This section offers guidance on how to customize these operations within the SDK.</p><h3 id=find-my-network-disableenable>Find My Network disable/enable
<a class=anchor href=#find-my-network-disableenable>#</a></h3><p>The enable/disable function for Find My Network has been implemented as a power on/off feature in the SDK. When in power off state, the chip will enter deep sleep mode, which is a state where the system consumes minimal power. The user interface for power on/off is defined in app_key.c. To trigger power on/off operations, call the function <strong>app_power_set_state</strong>.</p><p><strong>Note:</strong> By default, a long press of the button for 3 seconds will initiate the power-on operation. To trigger the power-off operation, quickly press the button three times, then long press it for 5 seconds immediately afterward.</p><h3 id=factory-reset>Factory Reset
<a class=anchor href=#factory-reset>#</a></h3><p>In app_key.c, you can initiate a factory reset by calling the function <strong>do_factory_reset</strong>.</p><p><strong>Note:</strong> By default, quickly press the button 5 times will trigger factory reset.</p><h3 id=read-serial-number>Read Serial Number
<a class=anchor href=#read-serial-number>#</a></h3><p>In app_key.c, you can enable reading the serial number by calling the function <strong>enable_serial_read</strong>.</p><p><strong>Note:</strong> By default, a double press of the button activates the serial number read mode.</p><h2 id=multiple-ble-applications-coexist>Multiple BLE applications coexist
<a class=anchor href=#multiple-ble-applications-coexist>#</a></h2><p>When multiple BLE applications are running simultaneously, they typically exhibit the following characteristics:</p><ol><li>Each application has its own type of advertising packets.</li><li>Each application performs different actions during connection and disconnection.</li><li>Each application defines its own unique GATT services.</li></ol><p>Multiple BLE applications can run simultaneously with the SDK, this is achieved through the following steps:</p><ol><li>When establishing a connection, map the connection index to the corresponding BLE application based on the type of advertising packet associated with the connection.</li><li>Subsequently, in the callback function for the same connection index, invoke the callback function of the corresponding BLE application for processing.</li></ol><p>This feature is implemented in &ldquo;app_ble.c&rdquo;, user can register a BLE application with &ldquo;app_ble_register&rdquo; function. Each BLE application is defined with a &ldquo;app_ble_t&rdquo; type structure which is composed by a few BLE callback functions. BLE callback functions not implemented for the application should be filled with “NULL”.
The &ldquo;check_adv_actv&rdquo; callback function is used to check if an activity index is related to the application, it should return 1 if this is true.</p><h2 id=build-the-project-and-load-the-program-to-the-flash>Build the project and load the program to the flash
<a class=anchor href=#build-the-project-and-load-the-program-to-the-flash>#</a></h2><h3 id=build-the-project-with-keil>Build the project with Keil
<a class=anchor href=#build-the-project-with-keil>#</a></h3><p>The Keil project file is “in-dev/proj/proj_ble_find_my/build/mdk/proj_ble_lp.uvprojx”, open it with Keil and then select the appropriate target (refer to <a href=#debug-option>Debug option</a>).
If the build is successful, a file named &ldquo;ble_find_my.bin&rdquo; will be generated in the &ldquo;in-dev/proj/proj_ble_find_my/build/mdk&rdquo; directory. That file is the firmware image users need to load it to the IN610&rsquo;s flash.</p><h3 id=build-the-project-with-gcc>Build the project with GCC
<a class=anchor href=#build-the-project-with-gcc>#</a></h3><p>Follow below steps to build the project.</p><ol><li>Unzip InPlay SDK to any directory.</li><li>If you&rsquo;re using Ubuntu, open the file in-dev/proj/common/gcc/linux.mk and set the GNU_INSTALL_ROOT to the path of your ARM GCC installation. For Windows users, modify the in-dev/proj/common/gcc/windows.mk file instead. Note that in windows.mk, you should use forward slashes &ldquo;/&rdquo; as the path separator, rather than backslashes &ldquo;\&rdquo;.</li><li>For Ubuntu users, navigate to the “in-dev/proj/proj_ble_find_my/build/gcc directory and execute the following command in your terminal:</li></ol><pre tabindex=0><code>make -j4
</code></pre><p>This will build a release version by default (No logs will output). If you want to build a debug version, run below command:</p><pre tabindex=0><code>make -j4 EN_DEBUG=1
</code></pre><p>Run below command to clean the project, then you can rebuild the project:</p><pre tabindex=0><code>make clean
</code></pre><p>If the build is successful, a file named &ldquo;ble_find_my.bin&rdquo; will be generated in the &ldquo;in-dev/proj/proj_ble_find_my/build/gcc&rdquo; directory. That file is the firmware image users need to load it to the IN610&rsquo;s flash.</p><p><strong>Note:</strong> If you build the project on Windows, PowerShell or Command Prompt are not supported. It is recommended to install <a href=https://gitforwindows.org/>Git for Windows</a> and execute the &ldquo;make&rdquo; command in &ldquo;Git Bash&rdquo; shell.</p><h4 id=ref-load-flash>Load the image to IN610L flash
<a class=anchor href=#ref-load-flash>#</a></h4><p>The boot pin signals the boot ROM of the IN610 to initiate firmware image download to the flash memory. If the device is already programmed, its state may be uncertain (e.g., it could be in deep sleep or active mode). In such cases, the boot pin assists in preparing the device for image loading. Follow these steps to load an image to the flash:</p><ul><li>Connect the boot pin to ground (not required if the device has never been programmed).</li><li>Perform a power cycle on the device or toggle the CHIP_EN pin from low to high.</li><li>Use the preferred tool to load the image to the device’s flash memory.</li></ul><h5 id=load-the-image-with-j-link>Load the image with J-Link
<a class=anchor href=#load-the-image-with-j-link>#</a></h5><p><em>Flash Programming with Keil</em></p><p>Keil supports flash programming via J-Link. For configuration details on the programming utility in Keil for IN610L, refer to <a href=https://inplay-inc.github.io/docs/in6xx/getting-started/installation/quick-start.html>Quick Start | InPlay Doc</a>. After building the project, users can use Keil to load the image into the device&rsquo;s flash memory.</p><p><em>Flash Programming without Keil</em></p><p>If Keil is unavailable, users can load the firmware binary (e.g., ble_find_my.bin) using J-Link. Refer to <a href=https://inplay-inc.github.io/docs/in6xx/getting-started/download/jflash-download-guide.html>IN610 J-Flash Download Guide</a>.</p><h5 id=load-the-image-with-uart>Load the image with UART
<a class=anchor href=#load-the-image-with-uart>#</a></h5><p>If J-Link is unavailable, users can load the firmware binary (e.g., ble_find_my.bin) using &ldquo;InPlay Programmer&rdquo; tool through UART. Refer to <a href=https://inplay-inc.github.io/docs/in6xx/getting-started/download/in_prog-guide.html>InPlay Programmer Guide</a>.</p><h3 id=run-the-program>Run the program
<a class=anchor href=#run-the-program>#</a></h3><p>The default debug UART port is UART1, using GPIO_2_1 for Tx and GPIO_2_7 for Rx, with a baud rate of 921600. If the program is a debug version and executes successfully, logs will be output through the UART port.</p><h2 id=load-software-authentication-token--uuid>Load Software Authentication Token / UUID
<a class=anchor href=#load-software-authentication-token--uuid>#</a></h2><p>Every Apple Find My accessory must have a unique token issued by Apple Inc. This token will be utilized once during the pairing of the accessory, and a new token will be provided during the pairing process, which should then be stored in non-volatile memory. This section explains the process of loading software authentication tokens on Windows.</p><h3 id=token-item-format>Token item format
<a class=anchor href=#token-item-format>#</a></h3><p>A token item in excel file is as:
<img src=../../../images/solution/FindMy/token.png alt>
A token item has an UUID and a base64-encoded token value.</p><h3 id=run-the-script>Run the script
<a class=anchor href=#run-the-script>#</a></h3><p>In610_fmna_program.py is the python script to load the token. It can support both J-Link and UART.</p><h4 id=load-token-with-j-link>Load token with J-Link
<a class=anchor href=#load-token-with-j-link>#</a></h4><p>Before running the script, follow <a href=https://inplay-inc.github.io/docs/in6xx/getting-started/download/jflash-download-guide.html>JFlash Programming | InPlay Doc</a> to make sure you can program IN610 flash with J-Link. You should also add the directory path that contains &ldquo;J-Link.exe&rdquo; to the PATH environment variable. You can refer <a href=https://www.architectryan.com/2018/03/17/add-to-the-path-on-windows-10/>Add to the PATH on Windows 10 and Windows 11 | Architect Ryan</a> to know how to do this.</p><p>To load the token, connect J-Link to IN610 chip and run the script as below:</p><pre tabindex=0><code>python ./in610_fmna_program.py --mfi-token [token-UUID] [token-base64]
</code></pre><p>where <strong>token-UUID</strong> represents the UUID of the token and <strong>token-base64</strong> is the base64-encoded token value.</p><p>This is an example:</p><pre tabindex=0><code>python ./in610_fmna_program.py --mfi-token 9748f95c-1678-4c73-9a77-15ed5c5473c9 MYG9ME0CAQECAQEERTBDAh8fGFpEniKAqaM+PoxcZc95fXq1p71bCC6KXoeB+89TAiAG8hHm33V/peyFz7f4Cqe+TmuoqW8qnVW+Z1nLXqD/gjBsAgECAgEBBGQxYjAJAgFmAgEBBAECMBACAWUCAQEECDfGbPyNAQAAMBECAgDKAgEBBAgAAAAAAAAACDAWAgIAyQIBAQQNMjYyOTgzLTczMDExMTAYAgFnAgEBBBB/5DXuqMpN+JOWBM/IEzc+
</code></pre><h4 id=load-token-with-uart>Load token with UART
<a class=anchor href=#load-token-with-uart>#</a></h4><p>Before running the script, check section <a href=#ref-load-flash>Load the image to IN610L flash</a> to ensure the chip is in Boot ROM mode and ready to download an image via UART. To load the token, connect your PC to any UART port on the IN610 chip. Then, include the &ldquo;&ndash;com&rdquo; parameter to specify the COM port number used for the connection. This is an example:</p><pre tabindex=0><code>python ./in610_fmna_program.py --com 89 --mfi-token 9748f95c-1678-4c73-9a77-15ed5c5473c9 MYG9ME0CAQECAQEERTBDAh8fGFpEniKAqaM+PoxcZc95fXq1p71bCC6KXoeB+89TAiAG8hHm33V/peyFz7f4Cqe+TmuoqW8qnVW+Z1nLXqD/gjBsAgECAgEBBGQxYjAJAgFmAgEBBAECMBACAWUCAQEECDfGbPyNAQAAMBECAgDKAgEBBAgAAAAAAAAACDAWAgIAyQIBAQQNMjYyOTgzLTczMDExMTAYAgFnAgEBBBB/5DXuqMpN+JOWBM/IEzc+
</code></pre><h2 id=generate-uarp-file>Generate UARP file
<a class=anchor href=#generate-uarp-file>#</a></h2><p>UARP is Apple’s Unified Accessory Restore Protocol. IN610 Find My SDK support firmware update compliant with UARP. Related files for this section are in proj_ble_find_my/tools/UARP directory.</p><h3 id=generate-the-input-bin-to-mfigr2-tool>Generate the input bin to &ldquo;mfigr2&rdquo; tool
<a class=anchor href=#generate-the-input-bin-to-mfigr2-tool>#</a></h3><p><strong>Note:</strong> Below steps can be done in Windows or MacOS</p><p>The .uarp file is an upgrade package for UARP. To generate .uarp file, preprocessing is required on the bin file that is generated from compilation:</p><p>Copy the generated binary file (ble_find_my.bin) to the same directory as script &ldquo;generate_bin.py&rdquo;, and rename it to &ldquo;input.bin&rdquo;, then double click on the &ldquo;generate_bin.py&rdquo;, a file named &ldquo;output_hashed.bin&rdquo; will be generated, and it will be used as input file in following steps. Copy output_hashed.bin to the same directory as MyUARPSuperBinary.plist and rename it as you like. Then fill version number and the input binary file name (renamed output_hashed.bin) in &ldquo;MyUARPSuperBinary.plist&rdquo;.</p><p><img src=../../../images/solution/FindMy/uarp_plist.png alt></p><h3 id=use-mfigr2-to-generate-uarp-file>Use &ldquo;mfigr2&rdquo; to generate .uarp file
<a class=anchor href=#use-mfigr2-to-generate-uarp-file>#</a></h3><p><strong>Note:</strong> below steps can only be done in MacOS</p><p>Run mfigr2 in shell to generate the UARP file (mfigr2 can only be executed in MacOS):</p><pre tabindex=0><code>./mfigr2 superbinary compose metaDataFilepath=UARPMFIMetaDataTable2.plist plistFilepath=MyUARPSuperBinary.plist payloadsFilepath=. superBinaryFilepath=MyUARPSuperBinary.uarp
</code></pre><p>If the command executes successfully, a file named &ldquo;MyUARPSuperBinary.uarp&rdquo; will be generated, this is the final .uarp file, you can rename it as you like.</p><h2 id=upgrade-the-find-my-accessory>Upgrade the Find My Accessory
<a class=anchor href=#upgrade-the-find-my-accessory>#</a></h2><h3 id=install-the-fmca-application>Install the FMCA Application
<a class=anchor href=#install-the-fmca-application>#</a></h3><p>Find My Certification Assistant requires a device running iOS or iPadOS 14.5 or later. Use your iPhone to open link <a href=https://apps.apple.com/us/app/find-my-certification-asst/id1532296125>Find My Certification Asst. on the App Store</a> on the App Store. Clicking on the link will open the App Store application, where you can proceed to install the app.</p><h3 id=install-find-my-network-configuration-profile>Install Find My Network Configuration Profile
<a class=anchor href=#install-find-my-network-configuration-profile>#</a></h3><p>Testing accessory firmware updates requires the installation of the Find My Network Configuration Profile. Extract the contents of the file &ldquo;FMCA Configuration Profile Jan 2024.zip&rdquo; to obtain a file named &ldquo;Find_My_Certification_Configuration.mobileconfig&rdquo;. Transfer this file to your iPhone using AirDrop (it is recommended to use AirDrop). Next, navigate to the &ldquo;Settings&rdquo; app on your iPhone, where you will find the &ldquo;Profile Downloaded&rdquo; button.</p><p><img src=../../../images/solution/FindMy/uarp_profile1.png alt></p><p>Click on the button and continue with the profile installation:</p><p><img src=../../../images/solution/FindMy/uarp_profile2.png alt></p><p>After restarting your iPhone, you can verify its installation by checking in &ldquo;Settings&rdquo; -> &ldquo;General&rdquo; -> &ldquo;VPN & Device Management&rdquo;.</p><p><img src=../../../images/solution/FindMy/uarp_profile3.png alt></p><h3 id=update-the-firmware>Update the firmware
<a class=anchor href=#update-the-firmware>#</a></h3><p>A UARP firmware file is denoted as &ldquo;xxxx.uarp.&rdquo; Begin by transferring the file to your iPhone. Prior to conducting the update, pair the Find My Accessory with your iPhone. Next, open the &ldquo;FMCA&rdquo; app, sign in using your Apple ID (which should be your company account), and locate your device under &ldquo;My Items&rdquo;. Select your device, then tap the &ldquo;Firmware Settings&rdquo; button. Choose the option to &ldquo;Select a File&mldr;&rdquo; and pick the .uarp file. Ensure you do not leave the page, and proceed to open the &ldquo;Find My&rdquo; app. Select the device you wish to upgrade; if the .uarp file is recognized correctly, the &ldquo;Update Available&rdquo; button will be displayed as shown below. Then tap the button to start upgrading. If you can’t see “Update Available” button, try to restart your iPhone and repeat the above steps.</p><p><img src=../../../images/solution/FindMy/uarp_update.png alt></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ol><li><a href=#overview>Overview</a></li><li><a href=#required-tools>Required tools</a><ol><li><a href=#compiler-and-build-tools>Compiler and build tools</a></li><li><a href=#image-and-token-programming-tools>Image and token programming tools</a></li></ol></li><li><a href=#source-code-and-software-architecture>Source code and software architecture</a></li><li><a href=#software-configuration>Software configuration</a><ol><li><a href=#bsp-configuration>BSP configuration</a></li><li><a href=#sdk-configuration>SDK configuration</a></li><li><a href=#supported-protocol>Supported protocol</a></li><li><a href=#google-fmdn-and-apple-fmna-configuration>Google FMDN and Apple FMNA configuration</a></li></ol></li><li><a href=#flash-layout>Flash layout</a></li><li><a href=#ui-customization>UI customization</a><ol><li><a href=#find-my-network-disableenable>Find My Network disable/enable</a></li><li><a href=#factory-reset>Factory Reset</a></li><li><a href=#read-serial-number>Read Serial Number</a></li></ol></li><li><a href=#multiple-ble-applications-coexist>Multiple BLE applications coexist</a></li><li><a href=#build-the-project-and-load-the-program-to-the-flash>Build the project and load the program to the flash</a><ol><li><a href=#build-the-project-with-keil>Build the project with Keil</a></li><li><a href=#build-the-project-with-gcc>Build the project with GCC</a></li><li><a href=#run-the-program>Run the program</a></li></ol></li><li><a href=#load-software-authentication-token--uuid>Load Software Authentication Token / UUID</a><ol><li><a href=#token-item-format>Token item format</a></li><li><a href=#run-the-script>Run the script</a></li></ol></li><li><a href=#generate-uarp-file>Generate UARP file</a><ol><li><a href=#generate-the-input-bin-to-mfigr2-tool>Generate the input bin to &ldquo;mfigr2&rdquo; tool</a></li><li><a href=#use-mfigr2-to-generate-uarp-file>Use &ldquo;mfigr2&rdquo; to generate .uarp file</a></li></ol></li><li><a href=#upgrade-the-find-my-accessory>Upgrade the Find My Accessory</a><ol><li><a href=#install-the-fmca-application>Install the FMCA Application</a></li><li><a href=#install-find-my-network-configuration-profile>Install Find My Network Configuration Profile</a></li><li><a href=#update-the-firmware>Update the firmware</a></li></ol></li></ol></nav></div></aside><script src=../../../js/fuse.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=../../../js/mark.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=../../../js/fastsearch.js crossorigin=anonymous referrerpolicy=no-referrer></script></main><footer class="bg-black bottom-0 w-100 pa3" style=position:fixed;bottom:0;width:100% role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" style=color:#000>&copy; Copyright 2025 InPlay Inc</a></div></footer></body></html>