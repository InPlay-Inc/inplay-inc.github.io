<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="GATT Programming Guide # Overview # The GATT (Generic Attribute) is a standard profile in BLE protocol which defines a framework of services and characteristics using ATT attributes as building blocks. The ATT protocol defineds a flat set of data structure called attributes, while GATT defines a hierarchy so that the attributes are grouped into primary and secondary services and these services can include characteristics. GATT also defines how a device will discover, read, write, notify, and indicate the characteristics based on ATT attribute access method."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="GATT Programming Guide"><meta property="og:description" content="GATT Programming Guide # Overview # The GATT (Generic Attribute) is a standard profile in BLE protocol which defines a framework of services and characteristics using ATT attributes as building blocks. The ATT protocol defineds a flat set of data structure called attributes, while GATT defines a hierarchy so that the attributes are grouped into primary and secondary services and these services can include characteristics. GATT also defines how a device will discover, read, write, notify, and indicate the characteristics based on ATT attribute access method."><meta property="og:type" content="article"><meta property="og:url" content="/docs/in6xxe/protocols-reference/ble/gatt_programming_guild.html"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2025-03-28T11:52:46+08:00"><title>GATT Programming Guide | InPlay Doc</title>
<link rel=manifest href=../../../../manifest.json><link rel=icon href=../../../../favicon.png><link rel=stylesheet href=../../../../book.min.7b5ca60448c7e874974d6d12156f89c2b32da59c25ae776b2522852d3ebb0865.css><script defer src=../../../../flexsearch.min.js></script><script defer src=../../../../en.search.min.2966e22b9358f7c33203378635888a2f1e6fe249e2eebd4a575ccff0b9b7045d.js></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=../../../../><span>InPlay Doc</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-ee8b8fb3a2ebd2cf7f56e1b840730602 class=toggle>
<label for=section-ee8b8fb3a2ebd2cf7f56e1b840730602 class="flex justify-between"><a role=button>IN100</a></label><ul></ul></li><li><span>IN6XXE</span><ul><li><input type=checkbox id=section-10a602a2afbac6b637ea6cafedc74c08 class=toggle>
<label for=section-10a602a2afbac6b637ea6cafedc74c08 class="flex justify-between"><a role=button>Getting Started</a></label><ul><li><input type=checkbox id=section-c0533e207424bbd85c1ed5e367c68a38 class=toggle>
<label for=section-c0533e207424bbd85c1ed5e367c68a38 class="flex justify-between"><a role=button>Installation</a></label><ul><li><a href=../../../../docs/in6xxe/getting-started/installation/quick-start.html>Quick Start</a></li><li><a href=../../../../docs/in6xxe/getting-started/installation/quick-start-with-gcc.html>Quick Start with GCC</a></li><li><a href=../../../../docs/in6xxe/getting-started/installation/run-zephyr-on-in6xxe.html>Run Zephyr on IN6XXE</a></li></ul></li><li><input type=checkbox id=section-4ee5b2397a599e035459a043e9269243 class=toggle>
<label for=section-4ee5b2397a599e035459a043e9269243 class="flex justify-between"><a role=button>Configration and Building</a></label><ul></ul></li><li><input type=checkbox id=section-0fcab4eb5e7d4aac163677313b48ef9d class=toggle>
<label for=section-0fcab4eb5e7d4aac163677313b48ef9d class="flex justify-between"><a role=button>Download Image</a></label><ul><li><a href=../../../../docs/in6xxe/getting-started/download/in_prog-guide.html>InPlay Programmer Guide</a></li><li><a href=../../../../docs/in6xxe/getting-started/download/jflash-download-guide.html>JFlash Programming</a></li></ul></li><li><input type=checkbox id=section-620480f69a74c9672be0a1ecdaca3f9a class=toggle>
<label for=section-620480f69a74c9672be0a1ecdaca3f9a class="flex justify-between"><a role=button>Testing and Debuging</a></label><ul><li><a href=../../../../docs/in6xxe/getting-started/testing/rtt-viewer-guide.html>Rtt Viewer Guide</a></li><li><a href=../../../../docs/in6xxe/getting-started/testing/debug-guide.html>Debug Guide</a></li><li><a href=../../../../docs/in6xxe/getting-started/testing/hci_command.html>HCI Command</a></li></ul></li></ul></li><li><input type=checkbox id=section-e9d08457f4c51bb4cb1e62cc94f322dc class=toggle>
<label for=section-e9d08457f4c51bb4cb1e62cc94f322dc class="flex justify-between"><a role=button>User Guides</a></label><ul><li><input type=checkbox id=section-e7402e460cdffdf6d75edb23894ae0c5 class=toggle>
<label for=section-e7402e460cdffdf6d75edb23894ae0c5 class="flex justify-between"><a role=button>Driver Integration</a></label><ul><li><a href=../../../../docs/in6xxe/user-guides/driver-integration/adc-guide.html>ADC Guide</a></li><li><a href=../../../../docs/in6xxe/user-guides/driver-integration/antenna-diversity.html>Antenna Diversity</a></li><li><a href=../../../../docs/in6xxe/user-guides/driver-integration/aoa-antenna.html>AOA Antenna Guide</a></li><li><a href=../../../../docs/in6xxe/user-guides/driver-integration/counter-development-guide.html>Counter Guide</a></li><li><a href=../../../../docs/in6xxe/user-guides/driver-integration/crc-guide.html>CRC Guide</a></li><li><a href=../../../../docs/in6xxe/user-guides/driver-integration/gpio-guide.html>GPIO Guide</a></li><li><a href=../../../../docs/in6xxe/user-guides/driver-integration/i2c-guide.html>I2C Communication</a></li><li><a href=../../../../docs/in6xxe/user-guides/driver-integration/spi-guide.html>SPI Communication</a></li><li><a href=../../../../docs/in6xxe/user-guides/driver-integration/uart-guide.html>UART Communication</a></li></ul></li><li><input type=checkbox id=section-54628a101b07426659df9579479aa6d8 class=toggle>
<label for=section-54628a101b07426659df9579479aa6d8 class="flex justify-between"><a role=button>NanoSync Technology</a></label><ul><li><a href=../../../../docs/in6xxe/user-guides/nanosync-technology/advanced-timer-guide.html>NanoSync Timer Guide</a></li><li><a href=../../../../docs/in6xxe/user-guides/nanosync-technology/trigger-handler-guide.html>NanoSync Engine Guide</a></li></ul></li></ul></li><li><input type=checkbox id=section-782653f6bb259ea0ac24d90b105a7dc0 class=toggle checked>
<label for=section-782653f6bb259ea0ac24d90b105a7dc0 class="flex justify-between"><a role=button>Protocol Reference</a></label><ul><li><input type=checkbox id=section-5f58fc20691c6de2641f46a033a55d28 class=toggle checked>
<label for=section-5f58fc20691c6de2641f46a033a55d28 class="flex justify-between"><a role=button>BLE</a></label><ul><li><a href=../../../../docs/in6xxe/protocols-reference/ble/inplay-ble5.0-at-command-set.html>BLE5.0 AT Command Set</a></li><li><a href=../../../../docs/in6xxe/protocols-reference/ble/gatt_programming_guild.html class=active>GATT Programming Guide</a></li><li><a href=../../../../docs/in6xxe/protocols-reference/ble/inplay_trx_profile.html>Inplay Transparent Data Transmission (TRx) profile User Guide</a></li></ul></li><li><input type=checkbox id=section-614316ec926d5d4f33757567a52185b7 class=toggle>
<label for=section-614316ec926d5d4f33757567a52185b7 class="flex justify-between"><a role=button>SDR</a></label><ul></ul></li><li><input type=checkbox id=section-7570f1740ec51694c058a21927f48553 class=toggle>
<label for=section-7570f1740ec51694c058a21927f48553 class="flex justify-between"><a role=button>SMULL</a></label><ul><li><a href=../../../../docs/in6xxe/protocols-reference/smull/inplay-smull-development-guide.html>SMULL Command Set</a></li></ul></li></ul></li><li><input type=checkbox id=section-67e1be7c03648874e72d6c95838f0f26 class=toggle>
<label for=section-67e1be7c03648874e72d6c95838f0f26 class="flex justify-between"><a href=../../../../docs/in6xxe/api-documatation.html>API Documentation</a></label><ul></ul></li><li><input type=checkbox id=section-42952569164db7f3f6f894adee6e4523 class=toggle>
<label for=section-42952569164db7f3f6f894adee6e4523 class="flex justify-between"><a role=button>Tools</a></label><ul><li><a href=../../../../docs/in6xxe/tools/ota-app-develop-guide.html>InPlay OTA App Development Guide</a></li><li><a href=../../../../docs/in6xxe/tools/ota-app.html>InPlayOTA App Guide</a></li></ul></li><li><input type=checkbox id=section-df7b9e936bf162d5e2a48a7f82ae2852 class=toggle>
<label for=section-df7b9e936bf162d5e2a48a7f82ae2852 class="flex justify-between"><a role=button>Examples and Use Case</a></label><ul><li><a href=../../../../docs/in6xxe/examples-and-use-case/debug-reference.html>Debug Reference</a></li><li><input type=checkbox id=section-26e2ce46acb4d4970a7850c67da09d8c class=toggle>
<label for=section-26e2ce46acb4d4970a7850c67da09d8c class="flex justify-between"><a role=button>Driver Examples</a></label><ul><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/adc-sample.html>ADC Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/aes-sample.html>AES Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/ecc-sample.html>ECC Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/gpio-interrupt-sample.html>GPIO Interrupt Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/gpio-reset-sample.html>GPIO Reset Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/gpio-sample.html>GPIO Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/gpio-wake-interrupt-sample.html>GPIO Wake Interrupt Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/gpio-wake-sample.html>GPIO Wake Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/i2c-sample.html>I2C Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/ir-sample.html>IR Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/keyboard-sample.html>Keyboard Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/pwm-sample.html>PWM Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/qdec-sample.html>QDEC Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/spi-sample.html>SPI Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/timer-sample.html>Timer Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/trigger-example-guide.html>Trigger Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/driver-examples/uart-sample-guide.html>UART Sample</a></li></ul></li><li><input type=checkbox id=section-542a43954a490ea3485a8e09b1381781 class=toggle>
<label for=section-542a43954a490ea3485a8e09b1381781 class="flex justify-between"><a role=button>Misc Examples</a></label><ul><li><a href=../../../../docs/in6xxe/examples-and-use-case/misc/hci-sample.html>HCI Sample</a></li></ul></li><li><input type=checkbox id=section-48884cb02637a51d8702e5e3edfef40c class=toggle>
<label for=section-48884cb02637a51d8702e5e3edfef40c class="flex justify-between"><a role=button>BLE Examples</a></label><ul><li><a href=../../../../docs/in6xxe/examples-and-use-case/ble/ble-advertising-sample.html>BLE advertising Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/ble/ble-gatt-sample.html>BLE GATT Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/ble/ble-initiation-sample.html>BLE Initiation Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/ble/ble-keyboard-sample.html>BLE Keyboard Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/ble/ble-scan-sample.html>BLE Scan Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/ble/ble-transparent-transmission-sample.html>BLE Transparent Transmission Sample</a></li></ul></li><li><input type=checkbox id=section-f989d19f5bf8a5459f7ee77a2dbc2a37 class=toggle>
<label for=section-f989d19f5bf8a5459f7ee77a2dbc2a37 class="flex justify-between"><a role=button>SDR Examples</a></label><ul><li><a href=../../../../docs/in6xxe/examples-and-use-case/sdr/sdr-1-master-to-multiple-slave-sample.html>SDR 1 to n Sample</a></li><li><a href=../../../../docs/in6xxe/examples-and-use-case/sdr/sdr-broadcast-sample-.html>SDR Broadcast Sample</a></li></ul></li></ul></li><li><input type=checkbox id=section-ecb777ba06679db84f6d08dc316cb5b2 class=toggle>
<label for=section-ecb777ba06679db84f6d08dc316cb5b2 class="flex justify-between"><a role=button>Development Kits</a></label><ul><li><a href=../../../../docs/in6xxe/dk/introduction-to-in6xxe-dk.html>Introduction to IN6XXE DK</a></li></ul></li></ul></li><li><input type=checkbox id=section-0bc0ac0bfec6b1ae25463138a2ae299e class=toggle>
<label for=section-0bc0ac0bfec6b1ae25463138a2ae299e class="flex justify-between"><a role=button>Solutions</a></label><ul><li><input type=checkbox id=section-f3c900f3ced930b282424e06187e7b20 class=toggle>
<label for=section-f3c900f3ced930b282424e06187e7b20 class="flex justify-between"><a role=button>Find My</a></label><ul><li><a href=../../../../docs/solutions/find-my/find-my-sdk-guide.html>Find My Sdk Guide</a></li></ul></li><li><input type=checkbox id=section-01b7a4cd745504c7ef54cce6910e09a8 class=toggle>
<label for=section-01b7a4cd745504c7ef54cce6910e09a8 class="flex justify-between"><a role=button>MultiConnNet</a></label><ul><li><a href=../../../../docs/solutions/multiconnnet/introduction.html>Introduction</a></li><li><a href=../../../../docs/solutions/multiconnnet/command-set.html>Module Instruction Set</a></li><li><a href=../../../../docs/solutions/multiconnnet/user-guild.html>User Guild</a></li></ul></li><li><input type=checkbox id=section-afc3c4284a3a81612ced6ce66dbe01d3 class=toggle>
<label for=section-afc3c4284a3a81612ced6ce66dbe01d3 class="flex justify-between"><a role=button>SMULL Pass-through Network</a></label><ul><li><a href=../../../../docs/solutions/smull/inplay-smull-development-guide.html>SMULL Command Set</a></li></ul></li><li><input type=checkbox id=section-3c853b7573728b720bb9f6d05f87354b class=toggle>
<label for=section-3c853b7573728b720bb9f6d05f87354b class="flex justify-between"><a role=button>Stellar</a></label><ul><li><a href=../../../../docs/solutions/stellar/stellar-gateway-wireless-communication-protocol-implementation-guide.html>Wireless Communication Protocol</a></li></ul></li><li><input type=checkbox id=section-15c87bcd4d931f9a897cb9565047755d class=toggle>
<label for=section-15c87bcd4d931f9a897cb9565047755d class="flex justify-between"><a role=button>Wireless Modbus Network</a></label><ul><li><a href=../../../../docs/solutions/modbus/wireless-modbus-demo-guide.html>Wireless Modbus Demo Guide</a></li><li><a href=../../../../docs/solutions/modbus/wireless-modbus-module.html>Wireless Modbus Module</a></li></ul></li></ul></li><li><input type=checkbox id=section-7e7f18f2dd14f1d43dd9be3434b07e7b class=toggle>
<label for=section-7e7f18f2dd14f1d43dd9be3434b07e7b class="flex justify-between"><a role=button>IN6XX</a></label><ul><li><input type=checkbox id=section-63252a7c2c256e222256d33b9f7363a6 class=toggle>
<label for=section-63252a7c2c256e222256d33b9f7363a6 class="flex justify-between"><a role=button>Getting Started</a></label><ul><li><input type=checkbox id=section-7e1496f76a7a40a604ce733f3e2bdacf class=toggle>
<label for=section-7e1496f76a7a40a604ce733f3e2bdacf class="flex justify-between"><a role=button>Installation</a></label><ul><li><a href=../../../../docs/in6xx/getting-started/installation/quick-start.html>Quick Start</a></li></ul></li><li><input type=checkbox id=section-7c5cc973fcb5ebb7f1a051dd9211755c class=toggle>
<label for=section-7c5cc973fcb5ebb7f1a051dd9211755c class="flex justify-between"><a role=button>Configration and Building</a></label><ul></ul></li><li><input type=checkbox id=section-fb6709c7bc2f74dd748ca851379bed41 class=toggle>
<label for=section-fb6709c7bc2f74dd748ca851379bed41 class="flex justify-between"><a role=button>Download Image</a></label><ul><li><a href=../../../../docs/in6xx/getting-started/download/in_prog-guide.html>InPlay Programmer Guide</a></li><li><a href=../../../../docs/in6xx/getting-started/download/jflash-download-guide.html>JFlash Programming</a></li><li><a href=../../../../docs/in6xx/getting-started/download/mp-tool-guide.html>MP Tool Guide</a></li></ul></li><li><input type=checkbox id=section-ed9f99fe4754a35a21fe02be8b0cb4f7 class=toggle>
<label for=section-ed9f99fe4754a35a21fe02be8b0cb4f7 class="flex justify-between"><a role=button>Testing and Debuging</a></label><ul><li><a href=../../../../docs/in6xx/getting-started/testing/rtt-viewer-guide.html>Rtt Viewer Guide</a></li><li><a href=../../../../docs/in6xx/getting-started/testing/debug-guide.html>Debug Guide</a></li><li><a href=../../../../docs/in6xx/getting-started/testing/hci_command.html>HCI Command</a></li></ul></li></ul></li><li><input type=checkbox id=section-4180a1cd8bda36e24d2a9c527ab046fe class=toggle>
<label for=section-4180a1cd8bda36e24d2a9c527ab046fe class="flex justify-between"><a role=button>Protocol Reference</a></label><ul><li><input type=checkbox id=section-7dd9db7eea8acbc738b8e6a6e64afef0 class=toggle>
<label for=section-7dd9db7eea8acbc738b8e6a6e64afef0 class="flex justify-between"><a role=button>BLE</a></label><ul><li><a href=../../../../docs/in6xx/protocol-reference/ble/gatt-programming-guide.html>GATT Programming Guide</a></li><li><a href=../../../../docs/in6xx/protocol-reference/ble/inplay_trx_profile.html>Inplay Transparent Data Transmission (TRx) profile User Guide</a></li></ul></li></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=../../../../svg/menu.svg class=book-icon alt=Menu>
</label><strong>GATT Programming Guide</strong>
<label for=toc-control><img src=../../../../svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ol><li><a href=#overview>Overview</a></li><li><a href=#server>Server</a><ol><li><a href=#create-service>Create Service</a></li><li><a href=#server-sending-data>Server Sending Data</a></li><li><a href=#server-receiving-data>Server Receiving Data</a></li><li><a href=#server-notification-enable-and-disable>Server notification enable and disable</a></li><li><a href=#read-request-from-client>Read request from client</a></li></ol></li><li><a href=#client>Client</a><ol><li><a href=#discovering-service-by-codein_ble_gatt_sdpcode>Discovering Service by <code>in_ble_gatt_sdp</code></a></li><li><a href=#discovering-service-by-codein_ble_gatt_discoverycode>Discovering Service by <code>in_ble_gatt_discovery</code></a></li><li><a href=#client-sending-data>Client Sending Data</a></li><li><a href=#client-receiving-data>Client Receiving Data</a></li><li><a href=#read-data>Read data</a></li></ol></li></ol></nav></aside></header><article class=markdown><h1 id=gatt-programming-guide>GATT Programming Guide
<a class=anchor href=#gatt-programming-guide>#</a></h1><hr><h2 id=overview>Overview
<a class=anchor href=#overview>#</a></h2><p>The GATT (Generic Attribute) is a standard profile in BLE protocol which defines a framework of services and characteristics using ATT attributes as building blocks. The ATT protocol defineds a flat set of data structure called attributes, while GATT defines a hierarchy so that the attributes are grouped into primary and secondary services and these services can include characteristics. GATT also defines how a device will discover, read, write, notify, and indicate the characteristics based on ATT attribute access method. The position of GATT in BLE protocol stack is shown in Figure 1.</p><p><img src=../../../../images/GATT_in_LE_protocol_stack.png alt=Figure title="Figure 1: GATT in LE protocol stack"></p><p>Inplay provides the following GATT programming APIs. In this ducument, some major APIs will be introduced and the rest please refer to prototype description in <em>inc/ble/in_ble_gatt.h</em> for detail.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_exc_mtu</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>uint16_t</span> <span style=color:#ff79c6>*</span>p_mtu, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_sdp</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>int</span> sdp_type, <span style=color:#8be9fd>ble_gatt_sdp_t</span> <span style=color:#ff79c6>*</span>p_sdp, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_discovery</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>int</span> disc_type, <span style=color:#8be9fd>ble_gatt_disc_t</span> <span style=color:#ff79c6>*</span>p_disc, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_read</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>int</span> read_type, <span style=color:#8be9fd>ble_gatt_read_req_t</span> <span style=color:#ff79c6>*</span>p_req, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_write</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>int</span> wrt_type, <span style=color:#8be9fd>ble_gatt_write_t</span> <span style=color:#ff79c6>*</span>p_write, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_excute_write</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>bool</span> execute, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_register_ind_ntf_event</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>bool</span> reg, <span style=color:#8be9fd>uint32_t</span> start_hdl, <span style=color:#8be9fd>uint32_t</span> end_hdl, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_indication_cfm</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>uint16_t</span> handle);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_send_ind</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>uint32_t</span> handle, <span style=color:#8be9fd>uint32_t</span> length, <span style=color:#8be9fd>uint8_t</span> <span style=color:#ff79c6>*</span>value, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_send_ntf</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>uint32_t</span> handle, <span style=color:#8be9fd>uint32_t</span> length, <span style=color:#8be9fd>uint8_t</span> <span style=color:#ff79c6>*</span>value, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_send_ntf_direct</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>uint32_t</span> handle, <span style=color:#8be9fd>uint32_t</span> length, <span style=color:#8be9fd>uint8_t</span> <span style=color:#ff79c6>*</span>value);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_send_svc_changed</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>uint32_t</span> svc_shdl, <span style=color:#8be9fd>uint32_t</span> svc_ehdl, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_add_svc</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>ble_gatt_svc_desc_t</span> <span style=color:#ff79c6>*</span>p_svc, <span style=color:#8be9fd>uint16_t</span> <span style=color:#ff79c6>*</span>p_hdl, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_get_svc_perm</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>uint16_t</span> start_hdl, <span style=color:#8be9fd>uint8_t</span> <span style=color:#ff79c6>*</span>p_perm, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_set_svc_perm</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>uint16_t</span> start_hdl, <span style=color:#8be9fd>uint8_t</span> perm, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_get_att_perm</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>uint16_t</span> handle, <span style=color:#8be9fd>ble_att_perm_t</span> <span style=color:#ff79c6>*</span>p_perm, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_set_att_perm</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>uint16_t</span> handle, <span style=color:#8be9fd>uint16_t</span> perm, <span style=color:#8be9fd>uint16_t</span> ext_perm, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_get_att_value</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>uint16_t</span> handle, <span style=color:#8be9fd>ble_att_val_t</span> <span style=color:#ff79c6>*</span>p_att_val, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_set_att_value</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>uint16_t</span> handle, <span style=color:#8be9fd>uint16_t</span> length, <span style=color:#8be9fd>uint8_t</span> <span style=color:#ff79c6>*</span>value, comp_cb callback);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_att_info_req_cfm</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>uint16_t</span> handle, <span style=color:#8be9fd>uint16_t</span> length, <span style=color:#8be9fd>uint8_t</span> status);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_write_req_cfm</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>uint8_t</span> conidx, <span style=color:#8be9fd>uint16_t</span> handle, <span style=color:#8be9fd>uint8_t</span> status);
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_read_req_cfm</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>uint8_t</span> conidx, <span style=color:#8be9fd>uint16_t</span> handle, <span style=color:#8be9fd>uint8_t</span> status, <span style=color:#8be9fd>uint16_t</span> length, <span style=color:#8be9fd>uint8_t</span> <span style=color:#ff79c6>*</span>value);
</span></span></code></pre></div><p>You can see almost all APIs above have one common parameter <code>callback</code> which is of below type. If it is NULL, API call will be blocked until BLE protocol stack finishes processing the request. Otherwise, API will return immediately and the designated callback function will be called asynchronously when BLE protocol stack finishes processing the request. Application can utilize this time to perform their own tasks in parallel.</p><p>Other APIs that do not have <code>callback</code> parameter just provide information to protocol stack and thus return immediately.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>typedef</span> <span style=color:#50fa7b>void</span> (<span style=color:#ff79c6>*</span>comp_cb)(<span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>int</span> status, <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>p_para);
</span></span></code></pre></div><p>Similar to ATT, GATT defines below two roles. A device may act as a server, a client, or both.</p><ol><li><p><em><strong>Client:</strong></em> The client initiates transactions to the server and can receive responses from the server. This includes commands and requests sent to the server and responses, indications and notifications received from the server.</p></li><li><p><em><strong>Server:</strong></em> The server receives the commands and requests from the client and sends responses, indications and notifications to the Client.</p></li></ol><p>From application&rsquo;s point of view, usually a device that is the data producer such as sensor nodes, implements the server role with services and characteristics needed to fulfill the application requirements. A device that is data consumer such as mobile phone or gateway, acts as a client.</p><p>Inplay Transparent Data Transmission (TRx) profile under <em>proj/common/util/in_trx_svc.c</em> and <em>proj/common/util/in_trx_clt.c</em> in SDK is a common profile developed based on GATT. Take it as an example to see the basic usage of these GATT APIs.</p><h2 id=server>Server
<a class=anchor href=#server>#</a></h2><p>Like said above, GATT server provides one or more services and characteristics included within services to fulfill application requirements. So the first step application needs to do is to create services.</p><h3 id=create-service>Create Service
<a class=anchor href=#create-service>#</a></h3><p>The function that creates GATT service is <code>in_ble_gatt_add_svc</code>, whose prototype is as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#6272a4>/**
</span></span></span><span style=display:flex><span><span style=color:#6272a4> ****************************************************************************************
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @brief Add a new Service  
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @note This can only issue by the Server.
</span></span></span><span style=display:flex><span><span style=color:#6272a4> *
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] p_svc					Pointer to service data structure  
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[out] p_hdl				Service handle
</span></span></span><span style=display:flex><span><span style=color:#6272a4> *
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @return IN_BLE_ERR_NO_ERROR if successful, otherwise failed. @see enum in_ble_error 
</span></span></span><span style=display:flex><span><span style=color:#6272a4> ****************************************************************************************
</span></span></span><span style=display:flex><span><span style=color:#6272a4> */</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_add_svc</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>ble_gatt_svc_desc_t</span> <span style=color:#ff79c6>*</span>p_svc, <span style=color:#8be9fd>uint16_t</span> <span style=color:#ff79c6>*</span>p_hdl, comp_cb callback);
</span></span></code></pre></div><ul><li><code>p_svc</code> is a pointer to <code>ble_gatt_svc_desc_t</code> in which service information is provided as well as all the attributes the service includes.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#6272a4>/// Attribute Description
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>typedef</span> <span style=color:#ff79c6>struct</span> 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/// Attribute UUID (LSB First) 
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint8_t</span> uuid[BLE_UUID_128_LEN];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#6272a4>/// Attribute Properties, @see enum ble_att_char_prop and @see enum ble_att_perm_prop
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint16_t</span> prop;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/// Maximum length of the attribute
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>///
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>/// Note:
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>/// For Included Services and Characteristic Declarations, this field contains targeted
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>/// handle.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>///
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>/// For Characteristic Extended Properties, this field contains 2 byte value
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>/// 
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>/// Not used Client Characteristic Configuration and Server Characteristic Configuration,
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>/// this field is not used.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>///
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint16_t</span> max_len;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>/// Attribute extended properties, @see enum ble_att_ext_prop 
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint16_t</span> ext_prop;
</span></span><span style=display:flex><span>} <span style=color:#8be9fd>ble_gatt_att_desc_t</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/// Service description
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>typedef</span> <span style=color:#ff79c6>struct</span> 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/// Attribute Start Handle (0 = dynamically allocated)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint16_t</span> start_hdl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>/// Service properties, @see ble_att_svc_prop
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint8_t</span> prop;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/// Service  UUID 
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint8_t</span> uuid[BLE_UUID_128_LEN];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/// Number of attributes
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint8_t</span> nb_att;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#6272a4>/// List of attribute description present in service.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>ble_gatt_att_desc_t</span> atts[];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>} <span style=color:#8be9fd>ble_gatt_svc_desc_t</span>;
</span></span></code></pre></div><p>In TRx profile, there is only one service which contains two majoy characteristics representing data tx ([TRX_CHAR_VAL_TX]) and rx ([TRX_CHAR_VAL_RX]) respectively. Their <code>uuid</code> are application defined. According to the GATT standard, each service must first contain an attribute called Characteristic Declaration with a fixed <code>uuid</code> 0x2803. In addition, the server usually allows the client to control whether the server is able to send data by notification or indicatation method or not. Therefore, for the characteristic of data rx, a Client Characteristic Configuration Descriptor with predefined <code>uuid</code> 0x2902 should be added in the service.</p><p>The <code>prop</code> defines the access method of the attribute, <strong>ATT_CHAR_PROP_READ</strong>, <strong>ATT_CHAR_PROP_WRITE</strong>, <strong>ATT_CHAR_PROP_NOTIFY</strong>, <strong>ATT_CHAR_PROP_INDICATE</strong> etc, which is clear in meaning by its name. For example, <strong>ATT_CHAR_PROP_NOTIFY</strong> should be specified for attribute [TRX_CHAR_VAL_TX] which represents the data tx, because TRX_CHAR_VAL_TX depends on the method of Notify. For attribute [TRX_CHAR_VAL_RX] representing the data rx, <strong>ATT_CHAR_PROP_WRITE</strong> should be specified, which means that the client sends data to the server through the method of GATT Write.</p><p>The <code>ext_prop</code> defines some extended attributes. Commonly used bits include <strong>ATT_EXT_PROP_UUID_LEN</strong> and <strong>ATT_EXT_PROP_RI</strong>. <strong>ATT_EXT_PROP_UUID_LEN</strong> defaults to 00, which means that the UUID is 16Bytes instead of 2Bytes (like UUIDs predefined by SIG). It should be noted that if the prop of the attribute [TRX_CHAR_VAL_TX] is readable, the bit ATT_EXT_PROP_RI must be set in this field.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>static</span> <span style=color:#ff79c6>const</span> <span style=color:#8be9fd>ble_gatt_att_desc_t</span> trx_atts[] <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>	[TRX_DECL_CHAR_RX] <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>		.uuid <span style=color:#ff79c6>=</span> { <span style=color:#bd93f9>0x03</span>, <span style=color:#bd93f9>0x28</span> },
</span></span><span style=display:flex><span>		.prop <span style=color:#ff79c6>=</span> ATT_CHAR_PROP_READ,
</span></span><span style=display:flex><span>		.max_len <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>,
</span></span><span style=display:flex><span>		.ext_prop <span style=color:#ff79c6>=</span> (<span style=color:#bd93f9>0</span> <span style=color:#ff79c6>&lt;&lt;</span> ATT_EXT_PROP_UUID_LEN_SHIFT),
</span></span><span style=display:flex><span>	},
</span></span><span style=display:flex><span>	[TRX_CHAR_VAL_RX] <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>		.uuid <span style=color:#ff79c6>=</span> {TRX_RX_UUID },
</span></span><span style=display:flex><span>		.prop <span style=color:#ff79c6>=</span> ATT_CHAR_PROP_WRITE<span style=color:#ff79c6>|</span>ATT_CHAR_PROP_WRITE_NO_RSP,
</span></span><span style=display:flex><span>		.max_len <span style=color:#ff79c6>=</span> TRX_MAX_LEN,
</span></span><span style=display:flex><span>		.ext_prop <span style=color:#ff79c6>=</span> (<span style=color:#bd93f9>2</span> <span style=color:#ff79c6>&lt;&lt;</span>ATT_EXT_PROP_UUID_LEN_SHIFT),
</span></span><span style=display:flex><span>	},
</span></span><span style=display:flex><span>	[TRX_DECL_CHAR_TX] <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>		.uuid <span style=color:#ff79c6>=</span> { <span style=color:#bd93f9>0x03</span>, <span style=color:#bd93f9>0x28</span> },
</span></span><span style=display:flex><span>		.prop <span style=color:#ff79c6>=</span> ATT_CHAR_PROP_READ,
</span></span><span style=display:flex><span>		.max_len <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>,
</span></span><span style=display:flex><span>		.ext_prop <span style=color:#ff79c6>=</span>  (<span style=color:#bd93f9>0</span> <span style=color:#ff79c6>&lt;&lt;</span> ATT_EXT_PROP_UUID_LEN_SHIFT),
</span></span><span style=display:flex><span>	},
</span></span><span style=display:flex><span>	[TRX_CHAR_VAL_TX] <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>		.uuid <span style=color:#ff79c6>=</span> {TRX_TX_UUID},
</span></span><span style=display:flex><span>		.prop <span style=color:#ff79c6>=</span> ATT_CHAR_PROP_NOTIFY <span style=color:#ff79c6>|</span> ATT_CHAR_PROP_INDICATE,
</span></span><span style=display:flex><span>		.max_len <span style=color:#ff79c6>=</span> TRX_MAX_LEN,
</span></span><span style=display:flex><span>		.ext_prop <span style=color:#ff79c6>=</span>  (<span style=color:#bd93f9>2</span> <span style=color:#ff79c6>&lt;&lt;</span> ATT_EXT_PROP_UUID_LEN_SHIFT),
</span></span><span style=display:flex><span>	},
</span></span><span style=display:flex><span>	[TRX_CLIENT_CHAR_CFG_TX] <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>		.uuid <span style=color:#ff79c6>=</span> { <span style=color:#bd93f9>0x02</span>, <span style=color:#bd93f9>0x29</span> }, <span style=color:#6272a4>//INB_ATT_DESC_SERVER_CHAR_CFG,
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>		.prop <span style=color:#ff79c6>=</span> ATT_CHAR_PROP_READ<span style=color:#ff79c6>|</span>ATT_CHAR_PROP_WRITE,
</span></span><span style=display:flex><span>		.max_len <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>,
</span></span><span style=display:flex><span>		.ext_prop <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>,
</span></span><span style=display:flex><span>	},
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Now create service. <code>start_hdl</code> is set to 0 to allow GATT profile allocate space for service. If it is known for sure the service will not be conflict with other existing services, specific start_hdl can be assigned. <code>uuid</code> is application defined UUID of service. <code>prop</code> is service property. The API&rsquo;s return value will be start attribute handle of service that is allocated by protocol stack if successful.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>int</span> nb_att <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>sizeof</span>(trx_atts)<span style=color:#ff79c6>/</span><span style=color:#ff79c6>sizeof</span>(trx_atts[<span style=color:#bd93f9>0</span>]);
</span></span><span style=display:flex><span><span style=color:#8be9fd>inb_gatt_svc_desc_t</span> <span style=color:#ff79c6>*</span>p_svc_desc <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>malloc</span>(<span style=color:#ff79c6>sizeof</span>(<span style=color:#8be9fd>inb_gatt_svc_desc_t</span>)  <span style=color:#ff79c6>+</span> nb_att <span style=color:#ff79c6>*</span> <span style=color:#ff79c6>sizeof</span>(<span style=color:#8be9fd>inb_gatt_att_desc_t</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p_svc_desc<span style=color:#ff79c6>-&gt;</span>start_hdl <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;	
</span></span><span style=display:flex><span>p_svc_desc<span style=color:#ff79c6>-&gt;</span>prop <span style=color:#ff79c6>=</span> (<span style=color:#bd93f9>2</span> <span style=color:#ff79c6>&lt;&lt;</span> ATT_SVC_PROP_UUID_LEN_SHIFT);		
</span></span><span style=display:flex><span><span style=color:#50fa7b>memcpy</span>(p_svc_desc<span style=color:#ff79c6>-&gt;</span>uuid, svc_uuid, <span style=color:#bd93f9>16</span>);
</span></span><span style=display:flex><span>p_svc_desc<span style=color:#ff79c6>-&gt;</span>nb_att <span style=color:#ff79c6>=</span> nb_att;
</span></span><span style=display:flex><span><span style=color:#50fa7b>memcpy</span>(p_svc_desc<span style=color:#ff79c6>-&gt;</span>atts, <span style=color:#ff79c6>&amp;</span>trx_atts[<span style=color:#bd93f9>0</span>], nb_att <span style=color:#ff79c6>*</span> <span style=color:#ff79c6>sizeof</span>(<span style=color:#8be9fd>inb_gatt_att_desc_t</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>res <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>in_ble_gatt_add_svc</span>(g_trx_svr.h_bstk, p_svc_desc, <span style=color:#ff79c6>&amp;</span>hdl, <span style=color:#8be9fd;font-style:italic>NULL</span>);
</span></span></code></pre></div><p>In short, the main concern when creating a service is to define the structure of the Characteristic in the service and their accessing method.</p><h3 id=server-sending-data>Server Sending Data
<a class=anchor href=#server-sending-data>#</a></h3><p>Below are APIs that server usually uses to send data, by GATT notify or indicate method.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#6272a4>/**
</span></span></span><span style=display:flex><span><span style=color:#6272a4> ****************************************************************************************
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @brief Send indication 
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @note This can only issue by the Server.
</span></span></span><span style=display:flex><span><span style=color:#6272a4> *
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] conidx				Connection index  
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] handle				Inidcation attribute handle
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] length				Inidcation attribute value length
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] value					Inidcation attribute value
</span></span></span><span style=display:flex><span><span style=color:#6272a4> *
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @return IN_BLE_ERR_NO_ERROR if successful, otherwise failed. @see enum in_ble_error 
</span></span></span><span style=display:flex><span><span style=color:#6272a4> ****************************************************************************************
</span></span></span><span style=display:flex><span><span style=color:#6272a4> */</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_send_ind</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>uint32_t</span> handle, <span style=color:#8be9fd>uint32_t</span> length, <span style=color:#8be9fd>uint8_t</span> <span style=color:#ff79c6>*</span>value, comp_cb callback);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/**
</span></span></span><span style=display:flex><span><span style=color:#6272a4> ****************************************************************************************
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @brief Send notification 
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @note This can only issue by the Server.
</span></span></span><span style=display:flex><span><span style=color:#6272a4> *
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] conidx				Connection index  
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] handle				Notification attribute handle
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] length				Notification attribute value length
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] value					Notification attribute value
</span></span></span><span style=display:flex><span><span style=color:#6272a4> *
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @return IN_BLE_ERR_NO_ERROR if successful, otherwise failed. @see enum in_ble_error 
</span></span></span><span style=display:flex><span><span style=color:#6272a4> ****************************************************************************************
</span></span></span><span style=display:flex><span><span style=color:#6272a4> */</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_send_ntf</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>uint32_t</span> handle, <span style=color:#8be9fd>uint32_t</span> length, <span style=color:#8be9fd>uint8_t</span> <span style=color:#ff79c6>*</span>value, comp_cb callback);
</span></span></code></pre></div><p>As mentioned above, application defines service structure and the create API returns handler of first attribute within the service. Now handlers of all Characteristic are known. However, what concerns us more is [TRX_CHAR_VAL_RX] and [TRX_CHAR_VAL_TX]. More exactly, for the server, only the handle of [TRX_CHAR_VAL_TX] is needed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>Handle of TX Characteristic = Start Handle + TRX_CHAR_VAL_TX + 1
</span></span></code></pre></div><p>The 1 in above formula actually represents the additional attribute &ldquo;Service Declaration&rdquo; in service, which is not described in service description structure when it is created but added automatically by GATT profile.</p><p>In sample TRx profile, it is call like below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>res <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>in_ble_gatt_send_ntf</span>(g_trx_svr.h_bstk, conidx, g_trx_svr.hdl_svc <span style=color:#ff79c6>+</span> TRX_CHAR_VAL_TX <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>, len, (<span style=color:#8be9fd>uint8_t</span> <span style=color:#ff79c6>*</span>)buf, <span style=color:#8be9fd;font-style:italic>NULL</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>res <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>in_ble_gatt_send_ind</span>(g_trx_svr.h_bstk, conidx, g_trx_svr.hdl_svc <span style=color:#ff79c6>+</span> TRX_CHAR_VAL_TX <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>, len, (<span style=color:#8be9fd>uint8_t</span> <span style=color:#ff79c6>*</span>)buf, <span style=color:#8be9fd;font-style:italic>NULL</span>);
</span></span></code></pre></div><p>In above sample, <code>g_trx_svr.hdl_svc</code> holds the Start handle of service. The <code>conidx</code> parameter in the API represents a specific connection. After connecting with the other device, the protocol stack will return this value to identify the connection.</p><p>Data notification and Indication has differet operations, as refered to GATT protocol:</p><blockquote><p><span style=color:grey><em>Server-initiated updates are the only asynchronous (i.e., not as a response to a client’s request) packets that can flow from the server to the client. These updates send timely alerts of changes in a characteristic value without the client having to regularly poll for them, saving both power and bandwidth. There are two types of server-initiated updates:</em></span></p></blockquote><blockquote><p><span style=color:grey><em>Characteristic Value Notification</em></span></p></blockquote><blockquote><p><span style=color:grey><em>Notifications are packets that include the handle of a characteristic value attribute along with its current value. The client receives them and can choose to act upon them, but it sends no acknowledgement back to the server to confirm reception. Along with write without response, this is the only other packet that does not comply with the standard request/response flow control mechanism in ATT, as the server can send any number of these notifications at any time. This feature uses the handle value notification (HVN) ATT packet.</em></span></p></blockquote><blockquote><p><span style=color:grey><em>Characteristic Value Indication</em></span></p></blockquote><blockquote><p><span style=color:grey><em>Indications, on the other hand, follow the same handle/value format but require an explicit acknowledgment from the client in the form of a confirmation. Note that although the server cannot send further indications (even for different character‐ istics) until it receives confirmation from the client (because this flows in the op‐ posite direction than the usual request/response pairs), an outstanding confirma‐ tion does not affect potential requests that the client might send in the meantime. This feature uses the handle value indication (HVI) and handle value confirma‐ tion (HVC) ATT packets.</em></span></p></blockquote><p><code>in_ble_gatt_send_ntf</code> implements the above-mentioned function of Characteristic Value Notification. It is called by the server when needed (for example, when the sensor changes) instead of being polled by the client. After being called, it is cached in the ATT protocol stack, and then returns immediately whether the response from the peer ATT layer is received or not.</p><p>Accordingly, <code>in_ble_gatt_send_ind</code> implements the above-mentioned function of Characteristic Value Indication. The main difference is that each call needs to wait for the response of the peer ATT layer before it can be completed and exit.</p><p>For example, assume that the parameter of Bluetooth connection is 1s. Call in_ble_gatt_send_ntf or <code>in_ble_gatt_send_ind</code> twice during the period. The application osThread that calls in_ble_gatt_send_ntf can continue to work. At the same time, at the next connection point, the data sent by the two calls can be received by the other side simultaneously. If the connection is suddenly interrupted, the data sent is lost. The thread calling in_ble_gatt_send_ind will get blocked until the next connection point has sent data and received the other party&rsquo;s response successfully. It holds true for the next call. That is, for the same two packets, using <code>in_ble_gatt_send_ind</code> causes an interval of 2 seconds, but it will ensure that the sent data will not get lost.</p><h3 id=server-receiving-data>Server Receiving Data
<a class=anchor href=#server-receiving-data>#</a></h3><p>When GATT profile receives data from peer connection device (client), it will post a <strong>GATT_EVT_WRT_REQ</strong> event to application since client send data via GATT write method. We will talk about it later on session of client send data. All server need to do is to register event callback when system is initialized by <code>in_ble_api_init</code>.</p><p>In sample TRx profile, <code>evt_wrt_req</code> is registered to handle this event when client writes to [TRX_CHAR_VAL_RX] and [TRX_CLIENT_CHAR_CFG_TX] characteristic, which both have ATT_CHAR_PROP_WRITE property when creating.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>static</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>evt_wrt_req</span>(<span style=color:#8be9fd>ble_evt_write_req_ind_t</span><span style=color:#ff79c6>*</span> ind, <span style=color:#8be9fd>uint8_t</span><span style=color:#ff79c6>*</span> status)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>*</span>status <span style=color:#ff79c6>=</span> IN_BLE_ATT_ERR_INVALID_HANDLE;
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>uint16_t</span> handle <span style=color:#ff79c6>=</span> ind<span style=color:#ff79c6>-&gt;</span>handle <span style=color:#ff79c6>-</span> g_trx_svr.hdl_svc <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>int</span> res <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>switch</span> (handle)
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>case</span> <span style=color:#8be9fd;font-style:italic>TRX_CHAR_VAL_RX</span>:
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			g_trx_svr.conidx <span style=color:#ff79c6>=</span> ind<span style=color:#ff79c6>-&gt;</span>conidx;
</span></span><span style=display:flex><span>			<span style=color:#ff79c6>if</span> (g_trx_svr.rx_callback) {
</span></span><span style=display:flex><span>				res <span style=color:#ff79c6>=</span> g_trx_svr.<span style=color:#50fa7b>rx_callback</span>(ind<span style=color:#ff79c6>-&gt;</span>conidx, ind<span style=color:#ff79c6>-&gt;</span>value, ind<span style=color:#ff79c6>-&gt;</span>length);
</span></span><span style=display:flex><span>				<span style=color:#ff79c6>if</span> (res <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>					<span style=color:#ff79c6>*</span>status <span style=color:#ff79c6>=</span> IN_BLE_ERR_NO_ERROR;
</span></span><span style=display:flex><span>				} <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>					<span style=color:#ff79c6>*</span>status <span style=color:#ff79c6>=</span> IN_BLE_GATT_ERR_WRITE;
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			} <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>				<span style=color:#ff79c6>*</span>status <span style=color:#ff79c6>=</span> IN_BLE_ERR_NO_ERROR;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		} <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>case</span> <span style=color:#8be9fd;font-style:italic>TRX_CLIENT_CHAR_CFG_TX</span>:
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			g_trx_svr.conidx <span style=color:#ff79c6>=</span> ind<span style=color:#ff79c6>-&gt;</span>conidx;
</span></span><span style=display:flex><span>			<span style=color:#ff79c6>if</span> (ind<span style=color:#ff79c6>-&gt;</span>length <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>2</span>) {
</span></span><span style=display:flex><span>				g_trx_svr.cfg[ind<span style=color:#ff79c6>-&gt;</span>conidx] <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>*</span>(<span style=color:#8be9fd>uint16_t</span><span style=color:#ff79c6>*</span>)ind<span style=color:#ff79c6>-&gt;</span>value;
</span></span><span style=display:flex><span>				<span style=color:#ff79c6>*</span>status <span style=color:#ff79c6>=</span> IN_BLE_ERR_NO_ERROR;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>				<span style=color:#ff79c6>if</span>( g_trx_svr.tx_en_callback )
</span></span><span style=display:flex><span>					g_trx_svr.<span style=color:#50fa7b>tx_en_callback</span>(ind<span style=color:#ff79c6>-&gt;</span>conidx, g_trx_svr.cfg[ind<span style=color:#ff79c6>-&gt;</span>conidx]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			} <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>				<span style=color:#ff79c6>*</span>status <span style=color:#ff79c6>=</span> IN_BLE_GATT_ERR_WRITE;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		} <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>default</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#6272a4>//We&#39;v done so let others handle it
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>			<span style=color:#ff79c6>if</span> (g_trx_svr.cbf.gatt.evt_wrt_req)
</span></span><span style=display:flex><span>				g_trx_svr.cbf.gatt.<span style=color:#50fa7b>evt_wrt_req</span>(ind, status);
</span></span><span style=display:flex><span>		}<span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Note it&rsquo;s important to set <code>*status</code> to the right value so that ATT protocol will send right response to client.</p><h3 id=server-notification-enable-and-disable>Server notification enable and disable
<a class=anchor href=#server-notification-enable-and-disable>#</a></h3><p>In TRx sample above, there is a configuration attribute [TRX_CLIENT_CHAR_CFG_TX] for data sending, with which the client can enable or disable the server to send data. For example, the sensor is not required to report data at some specific time. Obviously, this attribute is also writing for the client, so it is similar to the server&rsquo;s processing method of receiving data.</p><p>Enable or disable request is stored in variable <code>g_trx_svr.cfg</code>. When sending data, if it is disabled by client, data is not sent.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_trx_notify</span>(<span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>uint8_t</span> <span style=color:#ff79c6>*</span>buf, <span style=color:#8be9fd>uint32_t</span> len, <span style=color:#8be9fd>bool</span> ack)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>int</span> res <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> (len <span style=color:#ff79c6>&gt;</span> TRX_MAX_LEN) {
</span></span><span style=display:flex><span>		res <span style=color:#ff79c6>=</span> IN_BLE_PLT_ERR_INVALID_PARAM;
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>goto</span> out;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> (g_trx_svr.cfg[conidx] <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0x1</span>)
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>if</span> (ack)
</span></span><span style=display:flex><span>			res <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>in_ble_gatt_send_ind</span>(g_trx_svr.h_bstk, conidx, g_trx_svr.hdl_svc <span style=color:#ff79c6>+</span> TRX_CHAR_VAL_TX <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>, len, (<span style=color:#8be9fd>uint8_t</span> <span style=color:#ff79c6>*</span>)buf, <span style=color:#8be9fd;font-style:italic>NULL</span>);
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>else</span>
</span></span><span style=display:flex><span>			res <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>in_ble_gatt_send_ntf</span>(g_trx_svr.h_bstk, conidx, g_trx_svr.hdl_svc <span style=color:#ff79c6>+</span> TRX_CHAR_VAL_TX <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>, len, (<span style=color:#8be9fd>uint8_t</span> <span style=color:#ff79c6>*</span>)buf, <span style=color:#8be9fd;font-style:italic>NULL</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>if</span> (res <span style=color:#ff79c6>!=</span> IN_BLE_ERR_NO_ERROR) {
</span></span><span style=display:flex><span>			<span style=color:#50fa7b>PRINTD</span>(DBG_ERR, <span style=color:#f1fa8c>&#34;in_trx_notify: 0x%x</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, res);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>out</span>:
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> (<span style=color:#bd93f9>0</span><span style=color:#ff79c6>-</span>res);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=read-request-from-client>Read request from client
<a class=anchor href=#read-request-from-client>#</a></h3><p>Client can also directly poll data from server by ATT read method to characteristic that allow read access permission. In sample TRx service, we don’t grant [TRX_CHAR_VAL_TX] characteristic read access, which can only be notified and indicated. But [TRX_CLIENT_CHAR_CFG_TX] characteristic is readable so that client can know if server is allowed notification or not.</p><p>The sequence is when client send characteristic read request to server, ATT protocol stack sends <em>GATT_EVT_RD_REQ</em> event to inform application. Once the attribute handle is right, application provides actual data to ATT protocol stack so that it transmit back to client.</p><p>If <em>ble_app.c</em> is used, application is only required to register event callback for <em>GATT_EVT_RD_REQ</em> to provide data and <code>in_ble_gatt_read_req_cfm</code> is called by ble_app to send back to ATT protocol.</p><p>Here is what has been done in <em>ble_app.c</em> for the event.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>static</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>handle_default_gatt_evt</span>(<span style=color:#8be9fd>uint16_t</span> eid, <span style=color:#8be9fd>void</span><span style=color:#ff79c6>*</span> pv)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>switch</span> (eid)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>case</span> <span style=color:#8be9fd;font-style:italic>GATT_EVT_RD_REQ</span>:<span style=color:#6272a4>/// GATT read request indication  
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>		{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#ff79c6>if</span> (status <span style=color:#ff79c6>!=</span> IN_BLE_ERR_NO_ERROR) {
</span></span><span style=display:flex><span>				<span style=color:#ff79c6>if</span> (p_app<span style=color:#ff79c6>-&gt;</span>evt_cbf<span style=color:#ff79c6>-&gt;</span>gatt.evt_rd_req) {
</span></span><span style=display:flex><span>					p_app<span style=color:#ff79c6>-&gt;</span>evt_cbf<span style=color:#ff79c6>-&gt;</span>gatt.<span style=color:#50fa7b>evt_rd_req</span>(ind, <span style=color:#ff79c6>&amp;</span>status, <span style=color:#ff79c6>&amp;</span>data_len, <span style=color:#ff79c6>&amp;</span>data); 
</span></span><span style=display:flex><span>				} <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>					status <span style=color:#ff79c6>=</span> IN_BLE_ATT_ERR_REQUEST_NOT_SUPPORTED;
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#50fa7b>in_ble_gatt_read_req_cfm</span>(p_app<span style=color:#ff79c6>-&gt;</span>hdl_bs, ind<span style=color:#ff79c6>-&gt;</span>conidx, ind<span style=color:#ff79c6>-&gt;</span>handle, status, data_len, data);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here is what TRx server has done in registered cabllback function. First handle is checked whether it is beyond the scope in service and <em>IN_BLE_ATT_ERR_INVALID_HANDLE</em> is returned otherwise. For [TRX_CLIENT_CHAR_CFG_TX] characteristic, the data to be read is enable/disable configurations which is 2 bytes length.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>static</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>evt_rd_req</span>(<span style=color:#8be9fd>ble_evt_read_req_ind_t</span><span style=color:#ff79c6>*</span> ind, <span style=color:#8be9fd>uint8_t</span><span style=color:#ff79c6>*</span> status, <span style=color:#8be9fd>uint16_t</span><span style=color:#ff79c6>*</span> rd_data_len, <span style=color:#8be9fd>uint8_t</span><span style=color:#ff79c6>**</span> rd_data)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>*</span>status <span style=color:#ff79c6>=</span> IN_BLE_ATT_ERR_INVALID_HANDLE;
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>uint16_t</span> handle <span style=color:#ff79c6>=</span> ind<span style=color:#ff79c6>-&gt;</span>handle <span style=color:#ff79c6>-</span> g_trx_svr.hdl_svc <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>switch</span> (handle)
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>case</span> <span style=color:#8be9fd;font-style:italic>TRX_CLIENT_CHAR_CFG_TX</span>:
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			g_trx_svr.conidx <span style=color:#ff79c6>=</span> ind<span style=color:#ff79c6>-&gt;</span>conidx;
</span></span><span style=display:flex><span>			<span style=color:#ff79c6>*</span>rd_data_len <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>2</span>;
</span></span><span style=display:flex><span>			<span style=color:#ff79c6>*</span>rd_data <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>uint8_t</span><span style=color:#ff79c6>*</span>)<span style=color:#ff79c6>&amp;</span>g_trx_svr.cfg;
</span></span><span style=display:flex><span>			<span style=color:#ff79c6>*</span>status <span style=color:#ff79c6>=</span> IN_BLE_ERR_NO_ERROR;
</span></span><span style=display:flex><span>		} <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=client>Client
<a class=anchor href=#client>#</a></h2><p>On the other hand, the client has simpler work to do than server when initializing but more complicated after connection is established with server. Since all the APIs relies on attribute handle, unless service&rsquo;s start handle and its structure is well known in advance, such as both client and server use the sample TRx profile and the start handle of service is fixed, they are going to be obtained in the following procedure called Service Discovery Protocol (SDP).</p><p>The client must know the corresponding handle of the attribute in service before any client operations. If both parties in the connection are devices developed by yourself, it means that you are already familiar with the structure of the service, UUID of the service and the starting handle, so this condition is naturally satisfied, and you only need to constantize it in the code. Otherwise, you will need to obtain it through the discover process.</p><h3 id=discovering-service-by-codein_ble_gatt_sdpcode>Discovering Service by <code>in_ble_gatt_sdp</code>
<a class=anchor href=#discovering-service-by-codein_ble_gatt_sdpcode>#</a></h3><p>This function starts SDP in BLE stack and returns result through event. API prototype is as follows</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#6272a4>/**
</span></span></span><span style=display:flex><span><span style=color:#6272a4> ****************************************************************************************
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @brief Service Discovery Procedure
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @note This can only issue by the Client.
</span></span></span><span style=display:flex><span><span style=color:#6272a4> *
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] conidx				Connection index  
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] sdp_type				Service Discovery Type, @see enum ble_gatt_sdp_type
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] p_sdp					Pointer to service discovery paramters
</span></span></span><span style=display:flex><span><span style=color:#6272a4> *
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @return IN_BLE_ERR_NO_ERROR if successful, otherwise failed. @see enum in_ble_error 
</span></span></span><span style=display:flex><span><span style=color:#6272a4> ****************************************************************************************
</span></span></span><span style=display:flex><span><span style=color:#6272a4> */</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_sdp</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>int</span> sdp_type, <span style=color:#8be9fd>ble_gatt_sdp_t</span> <span style=color:#ff79c6>*</span>p_sdp, comp_cb callback);
</span></span></code></pre></div><p>There are three value for <code>sdp_type</code>: GATT_SDP_DISC_SVC, GATT_SDP_DISC_SVC_ALL, GATT_SDP_DISC_SVC_ALL. Here in sample TRx profile, GATT_SDP_DISC_SVC is used, just as the name suggests, discover one certain service.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>static</span> <span style=color:#8be9fd>int</span> <span style=color:#50fa7b>discover_svc</span>(<span style=color:#8be9fd>trx_clt_t</span> <span style=color:#ff79c6>*</span>p_trx_clt)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>int</span> res<span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>uint8_t</span> sdp_buf[<span style=color:#ff79c6>sizeof</span>(<span style=color:#8be9fd>ble_gatt_sdp_t</span>)<span style=color:#ff79c6>+</span>BLE_UUID_128_LEN];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>//Discover now
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#8be9fd>ble_gatt_sdp_t</span> <span style=color:#ff79c6>*</span>p_sdp <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>ble_gatt_sdp_t</span> <span style=color:#ff79c6>*</span>)sdp_buf;
</span></span><span style=display:flex><span>	p_sdp<span style=color:#ff79c6>-&gt;</span>start_hdl <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>	p_sdp<span style=color:#ff79c6>-&gt;</span>end_hdl <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0xFFFF</span>;
</span></span><span style=display:flex><span>	p_sdp<span style=color:#ff79c6>-&gt;</span>uuid_len <span style=color:#ff79c6>=</span> BLE_UUID_128_LEN;
</span></span><span style=display:flex><span>	<span style=color:#50fa7b>memcpy</span>(p_sdp<span style=color:#ff79c6>-&gt;</span>uuid, g_trx_clt.svc_uuid, BLE_UUID_128_LEN);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	res <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>in_ble_gatt_sdp</span>(g_trx_clt.h_bstk, p_trx_clt<span style=color:#ff79c6>-&gt;</span>peer_conidx, GATT_SDP_DISC_SVC, p_sdp, <span style=color:#8be9fd;font-style:italic>NULL</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> res;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Not only UUID of the service but also handle range is necessary. The range can be specified as 1~0xFFFF, which means searching all attributes. If the service is not within this handle range, discover fails either.</p><p>After service is discovered, <strong>GATT_EVT_SDP_SVC</strong> event is sent to application. Here in sample TRx profile, the event is retrieved by registered event handler <code>evt_sdp_svc</code> with ble_app component.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>static</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>evt_sdp_svc</span>(<span style=color:#8be9fd>ble_evt_sdp_svc_ind_t</span> <span style=color:#ff79c6>*</span>p_ind)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>int</span> res;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>trx_clt_t</span> <span style=color:#ff79c6>*</span>p_trx_clt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	p_trx_clt <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>trx_clt_get_by_conidx</span>(p_ind<span style=color:#ff79c6>-&gt;</span>conidx);
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> (p_trx_clt){
</span></span><span style=display:flex><span>		<span style=color:#50fa7b>PRINTD</span>(DBG_TRACE, <span style=color:#f1fa8c>&#34;Discover Service (%d, %d)</span><span style=color:#f1fa8c>\r\n</span><span style=color:#f1fa8c>&#34;</span>, p_ind<span style=color:#ff79c6>-&gt;</span>start_hdl, p_ind<span style=color:#ff79c6>-&gt;</span>end_hdl);
</span></span><span style=display:flex><span>		p_trx_clt<span style=color:#ff79c6>-&gt;</span>start_hdl <span style=color:#ff79c6>=</span> p_ind<span style=color:#ff79c6>-&gt;</span>start_hdl;
</span></span><span style=display:flex><span>		p_trx_clt<span style=color:#ff79c6>-&gt;</span>end_hdl <span style=color:#ff79c6>=</span> p_ind<span style=color:#ff79c6>-&gt;</span>end_hdl;
</span></span><span style=display:flex><span>		p_trx_clt<span style=color:#ff79c6>-&gt;</span>cfg <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#6272a4>//Means SDP procedure is over
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>		<span style=color:#ff79c6>if</span> (g_trx_clt.trx_clt_ready_cb)
</span></span><span style=display:flex><span>			g_trx_clt.<span style=color:#50fa7b>trx_clt_ready_cb</span>(p_trx_clt<span style=color:#ff79c6>-&gt;</span>peer_conidx, <span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>//We&#39;v done so let others handle it
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>if</span> (g_trx_clt.cbf.gatt.evt_sdp_svc)
</span></span><span style=display:flex><span>		g_trx_clt.cbf.gatt.<span style=color:#50fa7b>evt_sdp_svc</span>(p_ind);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_trx_clt_init</span>(<span style=color:#8be9fd>in_trx_clt_t</span> <span style=color:#ff79c6>*</span>p_in_trx_clt)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>//GATT event
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	p_cbf<span style=color:#ff79c6>-&gt;</span>gatt.evt_sdp_svc <span style=color:#ff79c6>=</span> evt_sdp_svc;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The start and end attribute handle of service are retrieved, which are the key to client. Now the client is functionable.</p><h3 id=discovering-service-by-codein_ble_gatt_discoverycode>Discovering Service by <code>in_ble_gatt_discovery</code>
<a class=anchor href=#discovering-service-by-codein_ble_gatt_discoverycode>#</a></h3><p><code>in_ble_gatt_sdp</code> is not the only API but maybe the simplest one. There is another option as following prototype which can do more.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#6272a4>/**
</span></span></span><span style=display:flex><span><span style=color:#6272a4> ****************************************************************************************
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @brief Attributes Discovery
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @note This can only issue by the Client.
</span></span></span><span style=display:flex><span><span style=color:#6272a4> *
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] conidx				Connection index  
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] disc_type			Attribute discovery type, @see enum ble_gatt_disc_type
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] p_disc					Pointer to attribute discovery paramters
</span></span></span><span style=display:flex><span><span style=color:#6272a4> *
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @return IN_BLE_ERR_NO_ERROR if successful, otherwise failed. @see enum in_ble_error 
</span></span></span><span style=display:flex><span><span style=color:#6272a4> ****************************************************************************************
</span></span></span><span style=display:flex><span><span style=color:#6272a4> */</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_discovery</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>int</span> disc_type, <span style=color:#8be9fd>ble_gatt_disc_t</span> <span style=color:#ff79c6>*</span>p_disc, comp_cb callback);
</span></span></code></pre></div><p>This function is to discovery not only service but single characteristic. In the sample, if we use this function to do service discovery, <code>disc_type</code> should be set to GATT_DISC_BY_UUID_SVC. Other parameters are similar to <code>in_ble_gatt_sdp</code>.</p><p>After service is discovered, a different <strong>GATT_EVT_DISC_SVC</strong> event is sent to application. Register this event handler is a MUST when using this option. The event handler looks like quite similar to event handler of <strong>GATT_EVT_SDP_SVC</strong>, and the key information are .</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>void</span> (<span style=color:#ff79c6>*</span>evt_disc_svc)(<span style=color:#8be9fd>ble_evt_disc_svc_ind_t</span> <span style=color:#ff79c6>*</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/// Discover Service indication Structure
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>typedef</span> <span style=color:#ff79c6>struct</span> 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#6272a4>/// Connection index
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#8be9fd>uint8_t</span> conidx;
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/// start handle
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint16_t</span> start_hdl;
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/// end handle
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint16_t</span> end_hdl;
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/// UUID length
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint8_t</span>  uuid_len;
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/// service UUID
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint8_t</span>  uuid[];
</span></span><span style=display:flex><span>} <span style=color:#8be9fd>ble_evt_disc_svc_ind_t</span>;
</span></span></code></pre></div><h3 id=client-sending-data>Client Sending Data
<a class=anchor href=#client-sending-data>#</a></h3><p>Usually the way that client sends data to server is via GATT write method. API prototype is as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#6272a4>/**
</span></span></span><span style=display:flex><span><span style=color:#6272a4> ****************************************************************************************
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @brief Write Attribute 
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @note This can only issue by the Client.
</span></span></span><span style=display:flex><span><span style=color:#6272a4> *
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] conidx				Connection index  
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] wrt_type				Attribute write type, @see enum ble_gatt_write_type
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] p_write				Pointer to attribute write paramters
</span></span></span><span style=display:flex><span><span style=color:#6272a4> *
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @return IN_BLE_ERR_NO_ERROR if successful, otherwise failed. @see enum in_ble_error 
</span></span></span><span style=display:flex><span><span style=color:#6272a4> ****************************************************************************************
</span></span></span><span style=display:flex><span><span style=color:#6272a4> */</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_write</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>int</span> wrt_type, <span style=color:#8be9fd>ble_gatt_write_t</span> <span style=color:#ff79c6>*</span>p_write, comp_cb callback);
</span></span></code></pre></div><p>The most importand parameter is <code>wrt_type</code>, which corresponds to various write methods in the GATT protocol: GATT_WRITE, GATT_WRITE_NO_RESPONSE, GATT_WRITE_SIGNED, GATT_EXEC_WRITE. Here in the sample the GATT_WRITE or GATT_WRITE_NO_RESPONSE type is used depending on if ack is needed.</p><p>First, the Characteristic in service must have write permissions. Reviewing the previous sample TRX service definition, characteristics [TRX_CHAR_VAL_RX] and [TRX_CLIENT_CHAR_CFG_TX] have <code>ATT_CHAR_PROP_WRITE</code> permission. The previous attribute corresponds to the direction of the data flow, which is from the client to the server, while the latter is used for the client to control the enabling of data transmission from the server.</p><p>With the start handle of the service that discovered, the client can use the <code>in_ble_gatt_write</code> method to send data to the server.</p><p>The <code>p_write</code> structure contains the parameters of the Write methods, as well as common parameters such as handle, offset and length. Note that for the GATT_WRITE type, the value of the &lsquo;auto_execute&rsquo; parameter is true.</p><p>Here is what sample TRX client has done:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_trx_clt_send</span>(<span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>uint8_t</span> <span style=color:#ff79c6>*</span>p_data, <span style=color:#8be9fd>uint16_t</span> data_len, <span style=color:#8be9fd>bool</span> ack)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>int</span> res <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>ble_gatt_write_t</span> <span style=color:#ff79c6>*</span>p_write<span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>NULL</span>;
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>trx_clt_t</span> <span style=color:#ff79c6>*</span>p_trx_clt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	p_trx_clt <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>trx_clt_get_by_conidx</span>(conidx);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> ( <span style=color:#ff79c6>!</span>p_trx_clt <span style=color:#ff79c6>||</span> p_trx_clt<span style=color:#ff79c6>-&gt;</span>peer_conidx <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span> <span style=color:#ff79c6>||</span> <span style=color:#50fa7b>trx_clt_is_undisced</span>(p_trx_clt)) {
</span></span><span style=display:flex><span>		res <span style=color:#ff79c6>=</span> IN_BLE_PLT_ERR_NOT_READY;
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>goto</span> out;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	p_write <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>ble_gatt_write_t</span><span style=color:#ff79c6>*</span>)<span style=color:#50fa7b>malloc</span>(<span style=color:#ff79c6>sizeof</span>(<span style=color:#8be9fd>ble_gatt_write_t</span>)<span style=color:#ff79c6>+</span>data_len);
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> (p_write) {
</span></span><span style=display:flex><span>		p_write<span style=color:#ff79c6>-&gt;</span>handle <span style=color:#ff79c6>=</span> p_trx_clt<span style=color:#ff79c6>-&gt;</span>start_hdl<span style=color:#ff79c6>+</span>TRX_CHAR_VAL_RX<span style=color:#ff79c6>+</span><span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>		p_write<span style=color:#ff79c6>-&gt;</span>auto_execute <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>true</span>;
</span></span><span style=display:flex><span>		p_write<span style=color:#ff79c6>-&gt;</span>offset <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>		p_write<span style=color:#ff79c6>-&gt;</span>length <span style=color:#ff79c6>=</span> data_len;
</span></span><span style=display:flex><span>		<span style=color:#50fa7b>memcpy</span>(p_write<span style=color:#ff79c6>-&gt;</span>value, p_data, data_len);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		res <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>in_ble_gatt_write</span>(g_trx_clt.h_bstk, p_trx_clt<span style=color:#ff79c6>-&gt;</span>peer_conidx, ack <span style=color:#ff79c6>?</span> <span style=color:#8be9fd;font-style:italic>GATT_WRITE</span> : GATT_WRITE_NO_RESPONSE , p_write, <span style=color:#8be9fd;font-style:italic>NULL</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#50fa7b>free</span>(p_write);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>out</span>:
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span><span style=color:#ff79c6>-</span>res;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>static</span> <span style=color:#8be9fd>int</span> <span style=color:#50fa7b>enable_ntf</span>(<span style=color:#8be9fd>trx_clt_t</span> <span style=color:#ff79c6>*</span>p_trx_clt, <span style=color:#8be9fd>uint16_t</span> enable)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>uint8_t</span> buf[<span style=color:#ff79c6>sizeof</span>(<span style=color:#8be9fd>ble_gatt_write_t</span>)<span style=color:#ff79c6>+</span><span style=color:#bd93f9>2</span>];
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>int</span> res <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>ble_gatt_write_t</span> <span style=color:#ff79c6>*</span>p_write<span style=color:#ff79c6>=</span>(<span style=color:#8be9fd>ble_gatt_write_t</span> <span style=color:#ff79c6>*</span>)buf;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	p_write<span style=color:#ff79c6>-&gt;</span>handle <span style=color:#ff79c6>=</span> p_trx_clt<span style=color:#ff79c6>-&gt;</span>start_hdl<span style=color:#ff79c6>+</span>TRX_CLIENT_CHAR_CFG_TX<span style=color:#ff79c6>+</span><span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>	p_write<span style=color:#ff79c6>-&gt;</span>auto_execute <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>true</span>;
</span></span><span style=display:flex><span>	p_write<span style=color:#ff79c6>-&gt;</span>offset <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>	p_write<span style=color:#ff79c6>-&gt;</span>length <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>2</span>;
</span></span><span style=display:flex><span>	<span style=color:#50fa7b>memcpy</span>(p_write<span style=color:#ff79c6>-&gt;</span>value, <span style=color:#ff79c6>&amp;</span>enable, p_write<span style=color:#ff79c6>-&gt;</span>length);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	res <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>in_ble_gatt_write</span>(g_trx_clt.h_bstk, p_trx_clt<span style=color:#ff79c6>-&gt;</span>peer_conidx, GATT_WRITE, p_write, <span style=color:#8be9fd;font-style:italic>NULL</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> res;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=client-receiving-data>Client Receiving Data
<a class=anchor href=#client-receiving-data>#</a></h3><p>Similar to server receiving data, when GATT profile receives data notification from peer connection device (server), it will post <strong>GATT_EVT_NTF</strong> or <strong>GATT_EVT_IND</strong> event to application. Client resiter event callback when system initialization.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>static</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>evt_peer_evt_ntf</span>(<span style=color:#8be9fd>ble_evt_ntf_ind_t</span> <span style=color:#ff79c6>*</span>p_ind)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>trx_clt_t</span> <span style=color:#ff79c6>*</span>p_trx_clt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	p_trx_clt <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>trx_clt_get_by_conidx</span>(p_ind<span style=color:#ff79c6>-&gt;</span>conidx);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> (p_trx_clt <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#50fa7b>trx_clt_is_undisced</span>(p_trx_clt)<span style=color:#ff79c6>==</span><span style=color:#8be9fd;font-style:italic>false</span> <span style=color:#ff79c6>&amp;&amp;</span> p_ind<span style=color:#ff79c6>-&gt;</span>handle <span style=color:#ff79c6>==</span> p_trx_clt<span style=color:#ff79c6>-&gt;</span>start_hdl <span style=color:#ff79c6>+</span> TRX_CHAR_VAL_TX <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>if</span> (g_trx_clt.trx_clt_rx_cb)
</span></span><span style=display:flex><span>			g_trx_clt.<span style=color:#50fa7b>trx_clt_rx_cb</span>(p_ind<span style=color:#ff79c6>-&gt;</span>conidx, p_ind<span style=color:#ff79c6>-&gt;</span>value, p_ind<span style=color:#ff79c6>-&gt;</span>length);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>//We&#39;v done so let others handle it
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>if</span> (g_trx_clt.cbf.gatt.evt_peer_evt_ntf)
</span></span><span style=display:flex><span>		g_trx_clt.cbf.gatt.<span style=color:#50fa7b>evt_peer_evt_ntf</span>(p_ind);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>static</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>evt_peer_evt_ind</span>(<span style=color:#8be9fd>ble_evt_ind_ind_t</span> <span style=color:#ff79c6>*</span>p_ind)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>trx_clt_t</span> <span style=color:#ff79c6>*</span>p_trx_clt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	p_trx_clt <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>trx_clt_get_by_conidx</span>(p_ind<span style=color:#ff79c6>-&gt;</span>conidx);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> (p_trx_clt <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#50fa7b>trx_clt_is_undisced</span>(p_trx_clt)<span style=color:#ff79c6>==</span><span style=color:#8be9fd;font-style:italic>false</span> <span style=color:#ff79c6>&amp;&amp;</span> p_ind<span style=color:#ff79c6>-&gt;</span>handle <span style=color:#ff79c6>==</span> p_trx_clt<span style=color:#ff79c6>-&gt;</span>start_hdl <span style=color:#ff79c6>+</span> TRX_CHAR_VAL_TX <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#50fa7b>in_ble_gatt_indication_cfm</span>( g_trx_clt.h_bstk, p_ind<span style=color:#ff79c6>-&gt;</span>conidx, p_ind<span style=color:#ff79c6>-&gt;</span>handle);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>if</span> (g_trx_clt.trx_clt_rx_cb)
</span></span><span style=display:flex><span>			g_trx_clt.<span style=color:#50fa7b>trx_clt_rx_cb</span>(p_ind<span style=color:#ff79c6>-&gt;</span>conidx, p_ind<span style=color:#ff79c6>-&gt;</span>value, p_ind<span style=color:#ff79c6>-&gt;</span>length);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6272a4>//We&#39;v done so let others handle it
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>if</span> (g_trx_clt.cbf.gatt.evt_peer_evt_ind)
</span></span><span style=display:flex><span>		g_trx_clt.cbf.gatt.<span style=color:#50fa7b>evt_peer_evt_ind</span>(p_ind);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The difference between <strong>GATT_EVT_NTF</strong> and <strong>GATT_EVT_IND</strong> is an additional <code>in_ble_gatt_indication_cfm</code> function must be called so that ATT protocol will send response to peer ATT protocol layer. That&rsquo;s why indication is more reliable data transmission of GATT.</p><h3 id=read-data>Read data
<a class=anchor href=#read-data>#</a></h3><p>Client can also directly poll data from server by ATT read method to characteristic that allows read access permission. In sample TRx service, [TRX_CLIENT_CHAR_CFG_TX] characteristic is readable so that client can know if server is already allowed notification or not.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#6272a4>/**
</span></span></span><span style=display:flex><span><span style=color:#6272a4> ****************************************************************************************
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @brief Read Attribute 
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @note This can only issue by the Client.
</span></span></span><span style=display:flex><span><span style=color:#6272a4> *
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] conidx				Connection index  
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] read_type			Attribute read type, @see enum ble_gatt_read_type
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @param[in] p_req				Pointer to attribute read paramters
</span></span></span><span style=display:flex><span><span style=color:#6272a4> *
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * @return IN_BLE_ERR_NO_ERROR if successful, otherwise failed. @see enum in_ble_error 
</span></span></span><span style=display:flex><span><span style=color:#6272a4> ****************************************************************************************
</span></span></span><span style=display:flex><span><span style=color:#6272a4> */</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>in_ble_gatt_read</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>hdl, <span style=color:#8be9fd>int</span> conidx, <span style=color:#8be9fd>int</span> read_type, <span style=color:#8be9fd>ble_gatt_read_req_t</span> <span style=color:#ff79c6>*</span>p_req, comp_cb callback);
</span></span></code></pre></div><p>The actual read result and value are retrieved by <em>GATT_EVT_RD_RSP_IND</em>. If <em>ble_app.c</em> is used, client must register event handler for the event. The register method is same as other callback function. Here is sample of callback function and actual read data is within <code>inb_evt_read_rsp_ind_t</code> parameter.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>evt_read_rsp_ind</span>(<span style=color:#8be9fd>ble_evt_read_rsp_ind_t</span> <span style=color:#ff79c6>*</span>p_ind)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ol><li><a href=#overview>Overview</a></li><li><a href=#server>Server</a><ol><li><a href=#create-service>Create Service</a></li><li><a href=#server-sending-data>Server Sending Data</a></li><li><a href=#server-receiving-data>Server Receiving Data</a></li><li><a href=#server-notification-enable-and-disable>Server notification enable and disable</a></li><li><a href=#read-request-from-client>Read request from client</a></li></ol></li><li><a href=#client>Client</a><ol><li><a href=#discovering-service-by-codein_ble_gatt_sdpcode>Discovering Service by <code>in_ble_gatt_sdp</code></a></li><li><a href=#discovering-service-by-codein_ble_gatt_discoverycode>Discovering Service by <code>in_ble_gatt_discovery</code></a></li><li><a href=#client-sending-data>Client Sending Data</a></li><li><a href=#client-receiving-data>Client Receiving Data</a></li><li><a href=#read-data>Read data</a></li></ol></li></ol></nav></div></aside><script src=../../../../js/fuse.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=../../../../js/mark.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=../../../../js/fastsearch.js crossorigin=anonymous referrerpolicy=no-referrer></script></main><footer class="bg-black bottom-0 w-100 pa3" style=position:fixed;bottom:0;width:100% role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" style=color:#000>&copy; Copyright 2025 InPlay Inc</a></div></footer></body></html>