<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="NanoSync Engine Guide # Introduction # NanoSync engine(trigger handler block) which can be used to perform many real-time events or tasks without the CPU’s intervention.
The NanoSync engine operates based on triggers and handlers. When a trigger (also called an event) happens, a handler will be invoked. A handler consists of a sequence of hardware actions (also called hardware tasks), which can be automatically executed by the hardware without the CPU intervention."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="NanoSync Engine Guide"><meta property="og:description" content="NanoSync Engine Guide # Introduction # NanoSync engine(trigger handler block) which can be used to perform many real-time events or tasks without the CPU’s intervention.
The NanoSync engine operates based on triggers and handlers. When a trigger (also called an event) happens, a handler will be invoked. A handler consists of a sequence of hardware actions (also called hardware tasks), which can be automatically executed by the hardware without the CPU intervention."><meta property="og:type" content="article"><meta property="og:url" content="/docs/in6xxe/development-guide/trigger-handler-guide.html"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2024-01-15T16:36:39+08:00"><title>NanoSync Engine Guide | InPlay Doc</title>
<link rel=manifest href=../../../manifest.json><link rel=icon href=../../../favicon.png><link rel=stylesheet href=../../../book.min.7b5ca60448c7e874974d6d12156f89c2b32da59c25ae776b2522852d3ebb0865.css><script defer src=../../../flexsearch.min.js></script><script defer src=../../../en.search.min.982825d3f10298ad5a9e9ccd14706317434c811f686888fe56d783e9f7ce40df.js></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=../../../><span>InPlay Doc</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-ee8b8fb3a2ebd2cf7f56e1b840730602 class=toggle>
<label for=section-ee8b8fb3a2ebd2cf7f56e1b840730602 class="flex justify-between"><a role=button>IN100</a></label><ul></ul></li><li><input type=checkbox id=section-bd5f68ab31375c3fb33a394941d6e585 class=toggle checked>
<label for=section-bd5f68ab31375c3fb33a394941d6e585 class="flex justify-between"><a role=button>IN6XXE</a></label><ul><li><input type=checkbox id=section-f4c88fd95948aa7bec88207c9ca0e9ac class=toggle>
<label for=section-f4c88fd95948aa7bec88207c9ca0e9ac class="flex justify-between"><a href=../../../docs/in6xxe/api.html>API Doc</a></label><ul></ul></li><li><input type=checkbox id=section-1c0bfc5570fab374696eb1006b3098d0 class=toggle checked>
<label for=section-1c0bfc5570fab374696eb1006b3098d0 class="flex justify-between"><a role=button>Development Guide</a></label><ul><li><a href=../../../docs/in6xxe/development-guide/adc-guide.html>ADC Guide</a></li><li><a href=../../../docs/in6xxe/development-guide/counter-development-guide.html>Counter Guide</a></li><li><a href=../../../docs/in6xxe/development-guide/trigger-handler-guide.html class=active>NanoSync Engine Guide</a></li><li><a href=../../../docs/in6xxe/development-guide/run-zephyr-on-in6xxe.html>Run Zephyr on IN6XXE</a></li></ul></li><li><input type=checkbox id=section-10a602a2afbac6b637ea6cafedc74c08 class=toggle>
<label for=section-10a602a2afbac6b637ea6cafedc74c08 class="flex justify-between"><a role=button>Getting Started</a></label><ul><li><a href=../../../docs/in6xxe/getting-started/rtt-viewer-guide.html>Rtt Viewer Guide</a></li><li><a href=../../../docs/in6xxe/getting-started/inplay-ble5.0-at-command-set.html>BLE5.0 AT Command Set</a></li><li><a href=../../../docs/in6xxe/getting-started/hci_command.html>HCI Command</a></li><li><a href=../../../docs/in6xxe/getting-started/introduction-to-in6xxe-dk.html>Introduction to IN6XXE DK</a></li><li><a href=../../../docs/in6xxe/getting-started/jflash-download-guide.html>JFlash Programming</a></li><li><a href=../../../docs/in6xxe/getting-started/quick-start-with-gcc.html>Quick Start with GCC</a></li><li><a href=../../../docs/in6xxe/getting-started/inplay-smull-development-guide.html>SMULL Command Set</a></li></ul></li><li><input type=checkbox id=section-9e1ce79bb040fc816033651173835259 class=toggle>
<label for=section-9e1ce79bb040fc816033651173835259 class="flex justify-between"><a role=button>Samples</a></label><ul><li><a href=../../../docs/in6xxe/samples/adc-example-guide.html>Adc Example Guide</a></li><li><a href=../../../docs/in6xxe/samples/aes-example-guide.html>AES Example Guide</a></li><li><a href=../../../docs/in6xxe/samples/ble-advertising-example-guide.html>Ble Advertising Example Guide</a></li><li><a href=../../../docs/in6xxe/samples/ble-initiation-example-guide.html>Ble Initiation Example Guide</a></li><li><a href=../../../docs/in6xxe/samples/ble-scan-example-guide.html>Ble Scan Example Guide</a></li><li><a href=../../../docs/in6xxe/samples/ble-transparent-transmission-example-guide.html>Ble Transparent Transmission Example Guide</a></li><li><a href=../../../docs/in6xxe/samples/debug-routine-guide.html>Debug Routine Guide</a></li><li><a href=../../../docs/in6xxe/samples/ecc-example-guide.html>Ecc Example Guide</a></li><li><a href=../../../docs/in6xxe/samples/gpio-example-guide.html>Gpio Example Guide</a></li><li><a href=../../../docs/in6xxe/samples/gpio-interrupt-example-guide.html>Gpio Interrupt Example Guide</a></li><li><a href=../../../docs/in6xxe/samples/gpio-reset-example-guide.html>Gpio Reset Example Guide</a></li><li><a href=../../../docs/in6xxe/samples/gpio-wake-example-guide.html>Gpio Wake Example Guide</a></li><li><a href=../../../docs/in6xxe/samples/gpio-wake-up-interrupt-example-guide.html>Gpio Wake Up Interrupt Example Guide</a></li><li><a href=../../../docs/in6xxe/samples/i2c-example-guide.html>I2 C Example Guide</a></li><li><a href=../../../docs/in6xxe/samples/keyboard-example-guide.html>Keyboard Example Guide</a></li><li><a href=../../../docs/in6xxe/samples/pwm-example-guide.html>Pwm Example Guide</a></li><li><a href=../../../docs/in6xxe/samples/qdec-routine-guide.html>Qdec Routine Guide</a></li><li><a href=../../../docs/in6xxe/samples/timer-routine-guide.html>Timer Routine Guide</a></li><li><a href=../../../docs/in6xxe/samples/trigger-example-guide.html>Trigger Example Guide</a></li><li><a href=../../../docs/in6xxe/samples/uart-routine-guide.html>Uart Routine Guide</a></li></ul></li><li><a href=../../../docs/in6xxe/quick-start.html>Quick Start</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=../../../svg/menu.svg class=book-icon alt=Menu>
</label><strong>NanoSync Engine Guide</strong>
<label for=toc-control><img src=../../../svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ol><li><a href=#introduction>Introduction</a></li><li><a href=#terminology>Terminology</a><ol><li><a href=#priority-queues>Priority Queues</a></li><li><a href=#trigger-id>Trigger id</a></li><li><a href=#trigger-header>Trigger Header</a></li><li><a href=#trigger-signals>Trigger Signals</a></li><li><a href=#trigger-command>Trigger Command</a></li><li><a href=#odcoutput-direct-controls>ODC(output direct controls)</a></li><li><a href=#memory>Memory</a></li><li><a href=#timer>Timer</a></li><li><a href=#ahbapb-bus>AHB/APB bus</a></li><li><a href=#trigger-address>Trigger Address</a></li></ol></li><li><a href=#trigger-configuration>Trigger configuration</a></li><li><a href=#trigger-command-1>Trigger command</a><ol><li><a href=#set-timer-command>Set timer command</a></li><li><a href=#wait-timer-command>Wait timer command</a></li><li><a href=#register-read-and-compare-command>Register read and compare command</a></li><li><a href=#register-write-command>Register write command</a></li><li><a href=#register-read-and-write-command>Register read and write command</a></li><li><a href=#register-copy-command>Register copy command</a></li><li><a href=#register-copy-with-mask-command>Register copy with mask command.</a></li><li><a href=#output-command>Output command</a></li><li><a href=#null-command>Null command</a></li></ol></li></ol></nav></aside></header><article class=markdown><h1 id=nanosync-engine-guide>NanoSync Engine Guide
<a class=anchor href=#nanosync-engine-guide>#</a></h1><h2 id=introduction>Introduction
<a class=anchor href=#introduction>#</a></h2><p>NanoSync engine(trigger handler block) which can be used to perform many real-time events or tasks without the CPU’s intervention.</p><p>The NanoSync engine operates based on triggers and handlers. When a trigger (also called an event) happens, a handler will be invoked. A handler consists of a sequence of hardware actions (also called hardware tasks), which can be automatically executed by the hardware without the CPU intervention. Typical triggers include GPIO input status change, timer time out, CPU interrupts etc.</p><h2 id=terminology>Terminology
<a class=anchor href=#terminology>#</a></h2><h3 id=priority-queues>Priority Queues
<a class=anchor href=#priority-queues>#</a></h3><p>NanoSync engine supports three priority queues:</p><ol><li><p>High Priority Queue:</p><ul><li>Supports up to 8 defined triggers.</li><li>Dedicated memory of 512 words.</li></ul></li><li><p>Middle Priority Queue:</p><ul><li>Supports up to 8 defined triggers.</li><li>Use shared memory, maximum memory usage is 512 words.</li></ul></li><li><p>Low Priority Queue:</p><ul><li>Supports up to 16 defined triggers.</li><li>Use shared memory, maximum memory usage is 512 words.</li></ul></li></ol><p>Higher priority queue can preempt lower priority queue.</p><h3 id=trigger-id>Trigger id
<a class=anchor href=#trigger-id>#</a></h3><p>In each queue, there are multiple triggers. And each trigger is assined a unique trigger id. The high priority and middle priority queues have 8 triggers, with trigger id ranging from 0 to 7. The low priority queue has 16 triggers, with trigger id ranging from 0 to 15.</p><p>When multiple triggers within the same queue are triggered simultaneously, the trigger with the smallest trigger id will be executed first.</p><h3 id=trigger-header>Trigger Header
<a class=anchor href=#trigger-header>#</a></h3><p>Every trigger has a header. Trigger headers are located at beginning of queue memory.</p><h3 id=trigger-signals>Trigger Signals
<a class=anchor href=#trigger-signals>#</a></h3><p>There are 255 trigger signals. And 0xFF is invalid trigger signal(refer to enum trig_cond_idx for details). Each trigger signal corresponds to an external or internal signal. When receive the signal(rising edge/failling edge), it triggers the corresponding trigger and executing the corresponding trigger command.</p><h3 id=trigger-command>Trigger Command
<a class=anchor href=#trigger-command>#</a></h3><p>A trigger can have multiple trigger commands. When activated, these commands will be executed sequentially.</p><h3 id=odcoutput-direct-controls>ODC(output direct controls)
<a class=anchor href=#odcoutput-direct-controls>#</a></h3><p>Used by output command. Has 127 output direct controls(refer to enum trig_odc_idx for details).</p><h3 id=memory>Memory
<a class=anchor href=#memory>#</a></h3><p>High priority queue has 512 words(2KB) dedicated memory(trig memory).
Middle and low priority queue use shared memory.</p><h3 id=timer>Timer
<a class=anchor href=#timer>#</a></h3><p>Each priority queue has its own 24-bit timer.</p><h3 id=ahbapb-bus>AHB/APB bus
<a class=anchor href=#ahbapb-bus>#</a></h3><p>Trigger handler can use APB or AHB bus to access peripheral registers.</p><ul><li><p>AHB bus:
CPU can access register with AHB bus. Read and write opertations don&rsquo;t have a fix lantency. The deviation is about 3us.</p></li><li><p>APB bus:
CPU can&rsquo;t access register with APB bus. Has fix latency, The deviation is less than 0.1us.</p></li></ul><h3 id=trigger-address>Trigger Address
<a class=anchor href=#trigger-address>#</a></h3><p>All trigger API use word address offset, not byte address. Address offset is start from 0x0.</p><h2 id=trigger-configuration>Trigger configuration
<a class=anchor href=#trigger-configuration>#</a></h2><p>Enable HW trigger in share memory configuration. The size is low priority queue memory size plus middle priority queue memory size. Maximum size is 4K(0x1000). If enable sleep, should select &ldquo;Reten Mem&rdquo; to retention shared memory and trigger memory.</p><p><img src=../../../images/trigger0.png alt></p><h2 id=trigger-command-1>Trigger command
<a class=anchor href=#trigger-command-1>#</a></h2><h3 id=set-timer-command>Set timer command
<a class=anchor href=#set-timer-command>#</a></h3><p>This commamnd is used to config the timer.The timer will be initialized with the initial value specified by the command (or the value in the control register) and will start counting down towards 0. If the auto-reload bit of the command is set to 0x1, the timer will restart with the initial value or the value from the control register after reaching 0. If the auto-reload bit of the command is set to 0x0, the timer will stop. If the timer is already running at the time of this command execution, it will be reset to the initial value and restart. Upon reaching 0, the timer can generate an interrupt signal.</p><h3 id=wait-timer-command>Wait timer command
<a class=anchor href=#wait-timer-command>#</a></h3><p>This command is used to wait for the timer to expire. This command will block the subsequent commands until the timer reaches the value specified in the command. If the “stop timer” bit is 1, the timer will stop counting when the timer reaches the expected value. If the “stop timer” bit is 0, the timer will continue counting after it reaches the expected value. It is strongly recommended that this command is NOT used in the highest priority queue as this command might delay the execution of all following triggers in the highest priority queue and also all triggers in the middle and lowest priority queues.</p><h3 id=register-read-and-compare-command>Register read and compare command
<a class=anchor href=#register-read-and-compare-command>#</a></h3><p>This command reads a value from a specific register, applies the mask on the read value and then compares the masked value to the expected value. When conditions fails, it can jump to another address to run command.</p><h3 id=register-write-command>Register write command
<a class=anchor href=#register-write-command>#</a></h3><p>This command write 32 bits value to register.</p><h3 id=register-read-and-write-command>Register read and write command
<a class=anchor href=#register-read-and-write-command>#</a></h3><p>The command reads the register value first and only update the bits to the write value where the corresponding bits in the mask is 1. The actual write value is computed as:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>	actual_write_value = (read_value &amp; ( ~ mask )) | (write_value &amp; mask).
</span></span></code></pre></div><h3 id=register-copy-command>Register copy command
<a class=anchor href=#register-copy-command>#</a></h3><p>This command will read the source register address value, and copy data to destination register.</p><h3 id=register-copy-with-mask-command>Register copy with mask command.
<a class=anchor href=#register-copy-with-mask-command>#</a></h3><p>This command will read the source register address value, apply the mask and write the masked value to the destination register address. The destination register value will also be read and the non-mask portion will be unchanged and written back to the destination register address together with the masked source register read value.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>written_value = (destination_read_value &amp; (~ mask)) | (source_read_value &amp; mask).
</span></span></code></pre></div><h3 id=output-command>Output command
<a class=anchor href=#output-command>#</a></h3><p>This command output signal with ODC(output direct controls). Refer to enum trig_hdl_idx for specific signal details. Each output command contains an output signal index, a toggle enable and an output value. If the index is larger than 127, the specific ODC is disabled. It is recommended to write 0x7F to all unused output signal index. If the toggle bit is 1 for a given output index, the corresponding output value will be ignored and the corresponding output signal will toggle its current output value to an opposite polarity.</p><p>Notice that we will use a control register to initialize the output port value which will be controlled by the trigger handler before the handler module is enabled. See hal_trig_hdl_gpio_out_en for reference.</p><h3 id=null-command>Null command
<a class=anchor href=#null-command>#</a></h3><p>This command is just a placeholder in the memory and will not execute any operation.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ol><li><a href=#introduction>Introduction</a></li><li><a href=#terminology>Terminology</a><ol><li><a href=#priority-queues>Priority Queues</a></li><li><a href=#trigger-id>Trigger id</a></li><li><a href=#trigger-header>Trigger Header</a></li><li><a href=#trigger-signals>Trigger Signals</a></li><li><a href=#trigger-command>Trigger Command</a></li><li><a href=#odcoutput-direct-controls>ODC(output direct controls)</a></li><li><a href=#memory>Memory</a></li><li><a href=#timer>Timer</a></li><li><a href=#ahbapb-bus>AHB/APB bus</a></li><li><a href=#trigger-address>Trigger Address</a></li></ol></li><li><a href=#trigger-configuration>Trigger configuration</a></li><li><a href=#trigger-command-1>Trigger command</a><ol><li><a href=#set-timer-command>Set timer command</a></li><li><a href=#wait-timer-command>Wait timer command</a></li><li><a href=#register-read-and-compare-command>Register read and compare command</a></li><li><a href=#register-write-command>Register write command</a></li><li><a href=#register-read-and-write-command>Register read and write command</a></li><li><a href=#register-copy-command>Register copy command</a></li><li><a href=#register-copy-with-mask-command>Register copy with mask command.</a></li><li><a href=#output-command>Output command</a></li><li><a href=#null-command>Null command</a></li></ol></li></ol></nav></div></aside><script src=../../../js/fuse.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=../../../js/mark.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=../../../js/fastsearch.js crossorigin=anonymous referrerpolicy=no-referrer></script></main><footer class="bg-black bottom-0 w-100 pa3" style=position:fixed;bottom:0;width:100% role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" style=color:#000>&copy; Copyright 2024 InPlay Inc</a></div></footer></body></html>